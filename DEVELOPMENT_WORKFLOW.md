# 🎯 권장 개발 워크플로우

## 개요
샌드박스 개발 + 서버 배포 방식을 기본으로, 상황에 따라 유연하게 조정

---

## 📋 일반 개발 (신규 기능, 개선)

### **샌드박스에서 개발 → 서버 배포**

```bash
┌─────────────────────────────────────────────────────┐
│  1. 샌드박스 (개발)                                     │
├─────────────────────────────────────────────────────┤
│  • 코드 작성                                          │
│  • 로컬 빌드 테스트                                    │
│  • Git 커밋 & 푸시                                    │
│  • 샌드박스 내 테스트 (가능한 범위)                      │
└─────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────┐
│  2. GitHub (중앙 저장소)                               │
├─────────────────────────────────────────────────────┤
│  • 코드 리뷰 (선택)                                    │
│  • PR 머지 (선택)                                     │
└─────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────┐
│  3. 서버 (배포 & 검증)                                 │
├─────────────────────────────────────────────────────┤
│  • git pull                                          │
│  • Docker 빌드                                       │
│  • 컨테이너 재시작                                     │
│  • 통합 테스트                                        │
│  • 사용자 확인                                        │
└─────────────────────────────────────────────────────┘
```

**장점:**
- ✅ 안전한 개발 (프로덕션 무영향)
- ✅ Git 히스토리 깔끔
- ✅ 여러 변경사항 한 번에 배포

---

## 🚨 긴급 수정 (버그 핫픽스)

### **서버 직접 수정 → 샌드박스 동기화**

```bash
┌─────────────────────────────────────────────────────┐
│  1. 서버 (긴급 수정)                                   │
├─────────────────────────────────────────────────────┤
│  • 최소한의 코드 수정                                  │
│  • 빠른 빌드 & 배포                                   │
│  • 즉시 테스트                                        │
│  • Git 커밋 & 푸시                                    │
└─────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────┐
│  2. 샌드박스 (동기화)                                  │
├─────────────────────────────────────────────────────┤
│  • git pull                                          │
│  • 변경사항 확인                                      │
│  • 추가 개선 작업                                     │
└─────────────────────────────────────────────────────┘
```

**사용 시나리오:**
- 🔴 프로덕션 장애 (500 에러, 크래시)
- 🔴 보안 취약점 발견
- 🔴 데이터 손실 위험

---

## 🔍 디버깅 (프로덕션 문제 재현)

### **서버 → 샌드박스 복제 → 분석**

```bash
┌─────────────────────────────────────────────────────┐
│  1. 서버 (문제 발생)                                   │
├─────────────────────────────────────────────────────┤
│  • 로그 수집                                          │
│  • 에러 재현 조건 파악                                 │
│  • 코드 스냅샷 확보                                   │
└─────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────┐
│  2. 샌드박스 (분석 & 수정)                             │
├─────────────────────────────────────────────────────┤
│  • 환경 복제 (코드, 데이터)                            │
│  • 문제 재현                                          │
│  • 원인 분석                                          │
│  • 수정 & 테스트                                      │
│  • Git 커밋                                          │
└─────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────┐
│  3. 서버 (수정사항 배포)                               │
├─────────────────────────────────────────────────────┤
│  • git pull                                          │
│  • 배포                                              │
│  • 검증                                              │
└─────────────────────────────────────────────────────┘
```

**장점:**
- ✅ 프로덕션 무영향
- ✅ 충분한 디버깅 시간
- ✅ 여러 해결책 시도 가능

---

## 📊 워크플로우 비교표

| 시나리오 | 권장 방법 | 이유 |
|---------|---------|------|
| 신규 기능 개발 | 샌드박스 → 서버 | 안전성, Git 관리 |
| UI 개선 | 샌드박스 → 서버 | 반복 테스트 용이 |
| 리팩토링 | 샌드박스 → 서버 | 큰 변경사항 |
| **긴급 버그 수정** | 서버 → 샌드박스 | 빠른 배포 |
| 프로덕션 디버깅 | 서버 → 샌드박스 → 서버 | 문제 재현 |
| 설정 변경 | 서버 직접 | 코드 변경 없음 |
| 데이터베이스 마이그레이션 | 서버 직접 | 신중함 필요 |

---

## 🛠️ 실전 예시

### **예시 1: 새로운 페이지 추가**
```bash
# ✅ 샌드박스에서 개발
cd /home/user/webapp
# 1. 페이지 컴포넌트 작성
# 2. 라우팅 추가
# 3. 메뉴 추가
git add frontend/src/pages/NewPage.tsx
git commit -m "feat: Add NewPage"
git push origin genspark_ai_developer

# 서버에서 배포
ssh root@139.150.11.99
cd /root/uvis
git pull origin genspark_ai_developer
cd frontend && npm run build && cd ..
docker-compose build frontend
docker-compose up -d frontend
```

### **예시 2: 로그인 실패 버그 (긴급)**
```bash
# ⚠️ 서버에서 직접 수정
ssh root@139.150.11.99
cd /root/uvis
# 빠른 수정
vim backend/app/api/auth.py
git add backend/app/api/auth.py
git commit -m "hotfix: Fix login validation"
git push origin genspark_ai_developer
docker-compose build backend
docker-compose up -d backend

# 나중에 샌드박스 동기화
cd /home/user/webapp
git pull origin genspark_ai_developer
```

### **예시 3: 401 에러 디버깅 (현재 상황)**
```bash
# 🔍 샌드박스에서 분석 & 수정
cd /home/user/webapp
# 1. 문제 분석 (axios 인터셉터 누락)
# 2. 수정 (config/api.ts 추가)
# 3. 테스트 (로컬 빌드)
git commit -m "fix: Centralize API configuration"
git push

# 서버 배포 & 검증
ssh root@139.150.11.99
# ... 배포 ...
# 테스트 후 확인
```

---

## 🎯 현재 프로젝트 권장사항

### **기본 워크플로우: 샌드박스 → 서버**

**이유:**
1. ✅ 이미 샌드박스 환경 구축됨
2. ✅ Git 워크플로우 확립됨
3. ✅ 안정적인 배포 프로세스
4. ✅ 롤백 가능

### **예외 상황:**
```
• 프로덕션 장애 (5분 이내 수정 필요)
  → 서버 직접 수정 후 샌드박스 동기화
  
• 설정 파일만 변경 (.env 등)
  → 서버 직접 수정 (Git 커밋 필수)
  
• 데이터베이스 긴급 작업
  → 서버 직접 작업 (백업 필수)
```

---

## 🔄 자동화 스크립트

### **샌드박스 → 서버 배포 스크립트**
```bash
#!/bin/bash
# deploy_to_server.sh

echo "🚀 Deploying to production server..."

# 1. 샌드박스에서 커밋 & 푸시
cd /home/user/webapp
git add -A
git commit -m "$1"  # 커밋 메시지
git push origin genspark_ai_developer

# 2. 서버 배포 명령 생성
echo ""
echo "📋 Run these commands on server:"
echo "cd /root/uvis"
echo "git pull origin genspark_ai_developer"
echo "cd frontend && npm run build && cd .."
echo "docker-compose build frontend"
echo "docker-compose up -d frontend"
```

### **서버 → 샌드박스 동기화 스크립트**
```bash
#!/bin/bash
# sync_from_server.sh

echo "🔄 Syncing from server..."

cd /home/user/webapp
git pull origin genspark_ai_developer

echo "✅ Synced successfully!"
echo "Current commit: $(git log --oneline -1)"
```

---

## 📝 베스트 프랙티스

### **DO ✅**
```
1. 항상 Git 커밋
   - 샌드박스든 서버든 모든 변경사항 커밋
   
2. 의미 있는 커밋 메시지
   - feat: / fix: / refactor: / docs: 사용
   
3. 배포 전 로컬 빌드 테스트
   - npm run build로 빌드 에러 확인
   
4. 작은 단위로 배포
   - 한 번에 많은 변경사항 X
   
5. 배포 후 즉시 테스트
   - 최소 5분 모니터링
```

### **DON'T ❌**
```
1. Git 없이 직접 파일 수정
   - 히스토리 추적 불가
   
2. 테스트 없이 배포
   - 문제 발견 늦어짐
   
3. 여러 기능 동시 배포
   - 문제 발생 시 원인 파악 어려움
   
4. 백업 없이 DB 작업
   - 데이터 손실 위험
   
5. .env 파일 Git 커밋
   - 보안 문제
```

---

## 🎓 결론

### **일반 개발: 샌드박스 → 서버 ⭐**
```
안전하고 체계적인 방법
Git 히스토리 깔끔
현재 프로젝트에 최적
```

### **긴급 상황: 서버 → 샌드박스**
```
빠른 대응 필요 시
즉시 수정 & 나중에 동기화
```

### **디버깅: 서버 → 샌드박스 → 서버**
```
문제 재현 및 분석
충분한 테스트
안전한 수정
```

**현재 권장:** 샌드박스 개발 유지, 긴급 시에만 서버 직접 수정
