import{c as G,j as e,r as o,b as y,z as n,L as J,B as x}from"./index-DWrA19-Q.js";import{u as K,L}from"./Layout-_7QmQsM4.js";import{C as _}from"./Card-BZBkuSEa.js";import{M as Q}from"./Modal-Bvdyb11v.js";import{I as p}from"./Input-Bh6Z0vgL.js";import{B as k}from"./Sidebar-DEFpisEa.js";import{U as W}from"./user-C9_NANMn.js";import{P as X}from"./phone-D0-IHEaG.js";import{M as Y}from"./mail-BajueKOj.js";import{M as D}from"./map-pin-BXKaUHvy.js";import{F as Z}from"./file-spreadsheet-ChC5M9z1.js";import{U as V}from"./upload-DeGKjjpU.js";import{D as ee}from"./download-Bm7c4jyO.js";import{P as se}from"./plus-Bbj8i8yA.js";import{T as P}from"./trash-2-D1AjY7Me.js";import"./bell-Muzov4ul.js";import"./index-BvcQtAB6.js";import"./x-cTU3yyaH.js";import"./package-CyltdJ0k.js";import"./truck-DYyomFIS.js";import"./chart-column-BBu1zpkI.js";import"./calendar-D1aWU6wz.js";import"./message-square-CQX4xtvJ.js";import"./zap-BDAzIdEF.js";import"./dollar-sign-zNa6eeND.js";import"./activity-B0jPijYH.js";import"./thermometer-C21NQbKK.js";import"./calculator-Cr8S2iSR.js";import"./clock-DDHN8A9u.js";import"./wrench-IdkLiNsk.js";import"./brain-BT-kJAZk.js";import"./settings-M2ZQNpfd.js";import"./chevron-down-DjioDqHQ.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],te=G("square-pen",ae),re=({client:t,onEdit:v,onCall:u,onEmail:g,onViewMap:f})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-3 border border-gray-200",onClick:v,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:e.jsx(k,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-900",children:t.name}),t.business_number&&e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["사업자: ",t.business_number]})]})]}),!t.is_active&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs font-medium",children:"비활성"})]}),t.contact_person&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:t.contact_person})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("button",{onClick:c=>{c.stopPropagation(),u==null||u()},className:"flex items-center justify-center gap-1.5 px-3 py-2 bg-green-50 hover:bg-green-100 rounded-lg active:scale-95 transition-all",children:[e.jsx(X,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"전화"})]}),t.email&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),g==null||g()},className:"flex items-center justify-center gap-1.5 px-3 py-2 bg-blue-50 hover:bg-blue-100 rounded-lg active:scale-95 transition-all",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700",children:"메일"})]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),f==null||f()},className:"flex items-center justify-center gap-1.5 px-3 py-2 bg-purple-50 hover:bg-purple-100 rounded-lg active:scale-95 transition-all",children:[e.jsx(D,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700",children:"지도"})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600 leading-relaxed",children:t.address})]})})]}),$e=()=>{const[t,v]=o.useState([]),[u,g]=o.useState(!0),[f,c]=o.useState(!1),[j,C]=o.useState(null),[a,r]=o.useState({code:"",name:"",client_type:"상차",address:"",address_detail:"",pickup_start_time:"09:00",pickup_end_time:"17:00",delivery_start_time:"09:00",delivery_end_time:"17:00",forklift_operator_available:!1,loading_time_minutes:30,contact_person:"",phone:"",notes:""}),[R,S]=o.useState(!1),[d,b]=o.useState([]),[N,U]=o.useState(!1),{isMobile:M}=K(),h=o.useCallback(async()=>{try{const s=await y.getClients();v(s.items||s),b([])}catch{n.error("거래처 목록을 불러오는데 실패했습니다")}finally{g(!1)}},[]),O=()=>{d.length===t.length?b([]):b(t.map(s=>s.id))},q=s=>{d.includes(s)?b(d.filter(i=>i!==s)):b([...d,s])},I=async s=>{if(window.confirm("이 거래처를 삭제하시겠습니까?"))try{await y.deleteClient(s),n.success("거래처가 삭제되었습니다"),h()}catch{n.error("거래처 삭제에 실패했습니다")}},$=async()=>{if(d.length===0){n.error("삭제할 거래처를 선택해주세요");return}if(window.confirm(`선택한 ${d.length}개의 거래처를 삭제하시겠습니까?`))try{await Promise.all(d.map(s=>y.deleteClient(s))),n.success(`${d.length}개의 거래처가 삭제되었습니다`),h()}catch{n.error("일괄 삭제에 실패했습니다")}},E=async()=>{try{const i=await(await fetch("/api/v1/clients/template/download")).blob(),m=window.URL.createObjectURL(i),l=document.createElement("a");l.href=m,l.download="clients_template.xlsx",document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(m),document.body.removeChild(l),n.success("양식 파일이 다운로드되었습니다")}catch{n.error("양식 다운로드에 실패했습니다")}},F=async()=>{try{const i=await(await fetch("/api/v1/clients/export/excel")).blob(),m=window.URL.createObjectURL(i),l=document.createElement("a");l.href=m,l.download=`clients_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(m),document.body.removeChild(l),n.success("거래처 목록이 다운로드되었습니다")}catch{n.error("다운로드에 실패했습니다")}},T=async s=>{var l;const i=(l=s.target.files)==null?void 0:l[0];if(!i)return;const m=new FormData;m.append("file",i);try{U(!0);const w=await fetch("/api/v1/clients/upload",{method:"POST",body:m});if(!w.ok)throw new Error("Upload failed");const H=await w.json();n.success(`${H.created||0}개의 거래처가 등록되었습니다`),h()}catch{n.error("파일 업로드에 실패했습니다")}finally{U(!1),s.target.value=""}};o.useEffect(()=>{h()},[h]);const B=o.useCallback(()=>{C(null),r({code:"",name:"",client_type:"상차",address:"",address_detail:"",pickup_start_time:"09:00",pickup_end_time:"17:00",delivery_start_time:"09:00",delivery_end_time:"17:00",forklift_operator_available:!1,loading_time_minutes:30,contact_person:"",phone:"",notes:""}),c(!0)},[]),z=o.useCallback(s=>{C(s),r({code:s.code||"",name:s.name||"",client_type:s.client_type||"상차",address:s.address||"",address_detail:s.address_detail||"",pickup_start_time:s.pickup_start_time||"09:00",pickup_end_time:s.pickup_end_time||"17:00",delivery_start_time:s.delivery_start_time||"09:00",delivery_end_time:s.delivery_end_time||"17:00",forklift_operator_available:s.forklift_operator_available||!1,loading_time_minutes:s.loading_time_minutes||30,contact_person:s.contact_person||"",phone:s.phone||"",notes:s.notes||""}),c(!0)},[]),A=o.useCallback(async s=>{var i,m;s.preventDefault(),S(!0);try{j?(await y.updateClient(j.id,a),n.success("거래처가 수정되었습니다")):(await y.createClient(a),n.success("거래처가 등록되었습니다")),c(!1),h()}catch(l){n.error(((m=(i=l.response)==null?void 0:i.data)==null?void 0:m.detail)||"거래처 처리에 실패했습니다")}finally{S(!1)}},[a,j,h]);return u?e.jsx(L,{children:e.jsx(J,{})}):e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"거래처 관리"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"거래처 정보를 관리하세요"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 md:mt-0",children:[e.jsxs(x,{variant:"secondary",onClick:E,children:[e.jsx(Z,{size:20,className:"mr-2"}),"양식 다운로드"]}),e.jsxs("label",{children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:T,className:"hidden",disabled:N}),e.jsxs(x,{variant:"secondary",as:"span",disabled:N,children:[e.jsx(V,{size:20,className:"mr-2"}),N?"업로드 중...":"엑셀 업로드"]})]}),e.jsxs(x,{variant:"secondary",onClick:F,children:[e.jsx(ee,{size:20,className:"mr-2"}),"전체 다운로드"]}),e.jsxs(x,{variant:"primary",onClick:B,children:[e.jsx(se,{size:20,className:"mr-2"}),"신규 등록"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전체 거래처"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:t.length})]})}),e.jsx(_,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"활성 거래처"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:t.filter(s=>s.is_active).length})]})})]}),d.length>0&&e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[d.length,"개 항목 선택됨"]}),e.jsxs(x,{variant:"danger",size:"sm",onClick:$,children:[e.jsx(P,{size:16,className:"mr-2"}),"선택 항목 삭제"]})]})}),M?e.jsx("div",{className:"px-4 space-y-3",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-600",children:"등록된 거래처가 없습니다"})]}):t.map(s=>e.jsx(re,{client:{id:s.id,name:s.name,business_number:s.business_number,contact_person:s.contact_person,phone:s.phone,email:s.email,address:s.address,is_active:s.is_active},onEdit:()=>z(s),onCall:()=>window.location.href=`tel:${s.phone}`,onEmail:()=>{s.email&&(window.location.href=`mailto:${s.email}`)},onViewMap:()=>{const i=encodeURIComponent(s.address);window.open(`https://www.google.com/maps/search/?api=1&query=${i}`,"_blank")}},s.id))}):e.jsx(_,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"w-12 py-3 px-4",children:e.jsx("input",{type:"checkbox",checked:t.length>0&&d.length===t.length,onChange:O,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"거래처명"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"사업자번호"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"담당자"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"연락처"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"이메일"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"상태"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"작업"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-8 text-gray-500",children:[e.jsx(k,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"등록된 거래처가 없습니다"})]})}):t.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"checkbox",checked:d.includes(s.id),onChange:()=>q(s.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"py-3 px-4 font-medium",children:s.name}),e.jsx("td",{className:"py-3 px-4",children:s.business_number}),e.jsx("td",{className:"py-3 px-4",children:s.contact_person}),e.jsx("td",{className:"py-3 px-4",children:s.phone}),e.jsx("td",{className:"py-3 px-4",children:s.email||"-"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.is_active?"활성":"비활성"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(x,{size:"sm",variant:"secondary",onClick:()=>z(s),children:[e.jsx(te,{size:14,className:"mr-1"}),"수정"]}),e.jsxs(x,{size:"sm",variant:"danger",onClick:()=>I(s.id),children:[e.jsx(P,{size:14,className:"mr-1"}),"삭제"]})]})})]},s.id))})]})})}),e.jsx(Q,{isOpen:f,onClose:()=>c(!1),title:j?"거래처 수정":"거래처 등록",size:"lg",children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx(p,{label:"거래처코드",name:"code",value:a.code,onChange:s=>r({...a,code:s.target.value}),placeholder:"CUST-0001",required:!0}),e.jsx(p,{label:"거래처명",name:"name",value:a.name,onChange:s=>r({...a,name:s.target.value}),placeholder:"(주)서울냉동",required:!0}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["구분 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"client_type",value:a.client_type,onChange:s=>r({...a,client_type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"상차",children:"상차"}),e.jsx("option",{value:"하차",children:"하차"}),e.jsx("option",{value:"양쪽",children:"양쪽 (상차/하차 모두 가능)"})]})]}),e.jsx(p,{label:"주소",name:"address",value:a.address,onChange:s=>r({...a,address:s.target.value}),placeholder:"서울특별시 송파구 문정동 123",required:!0}),e.jsx(p,{label:"상세주소",name:"address_detail",value:a.address_detail,onChange:s=>r({...a,address_detail:s.target.value}),placeholder:"1층"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"상차 가능 시작",name:"pickup_start_time",type:"time",value:a.pickup_start_time,onChange:s=>r({...a,pickup_start_time:s.target.value})}),e.jsx(p,{label:"상차 가능 종료",name:"pickup_end_time",type:"time",value:a.pickup_end_time,onChange:s=>r({...a,pickup_end_time:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"하차 가능 시작",name:"delivery_start_time",type:"time",value:a.delivery_start_time,onChange:s=>r({...a,delivery_start_time:s.target.value})}),e.jsx(p,{label:"하차 가능 종료",name:"delivery_end_time",type:"time",value:a.delivery_end_time,onChange:s=>r({...a,delivery_end_time:s.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"forklift_operator_available",checked:a.forklift_operator_available,onChange:s=>r({...a,forklift_operator_available:s.target.checked}),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"forklift_operator_available",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"지게차 운전능력 (가능/불가능)"})]}),e.jsx(p,{label:"상하차 소요시간 (분)",name:"loading_time_minutes",type:"number",value:a.loading_time_minutes,onChange:s=>r({...a,loading_time_minutes:parseInt(s.target.value)||30}),placeholder:"30",min:"1",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"담당자명",name:"contact_person",value:a.contact_person,onChange:s=>r({...a,contact_person:s.target.value}),placeholder:"홍길동"}),e.jsx(p,{label:"전화번호",name:"phone",value:a.phone,onChange:s=>r({...a,phone:s.target.value}),placeholder:"02-1234-5678"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"특이사항"}),e.jsx("textarea",{name:"notes",value:a.notes,onChange:s=>r({...a,notes:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"주차공간 협소"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx(x,{variant:"secondary",onClick:()=>c(!1),type:"button",children:"취소"}),e.jsx(x,{variant:"primary",type:"submit",isLoading:R,children:j?"수정":"등록"})]})]})})]})})};export{$e as default};
