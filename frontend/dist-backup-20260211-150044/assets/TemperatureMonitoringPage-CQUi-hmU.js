import{r as a,b as n,j as t,T as d}from"./index-DWrA19-Q.js";import{L as E,C as V,a as M,b as H,P as K,c as P,p as O,d as W,e as Z,i as q}from"./index-8f5neQgV.js";import{T as z}from"./thermometer-C21NQbKK.js";import{A as G}from"./activity-B0jPijYH.js";import{C as J}from"./clock-DDHN8A9u.js";import{C as Q}from"./circle-check-big-CgFKxf-k.js";V.register(M,H,K,P,O,W,Z,q);const se=()=>{var f;const[c,w]=a.useState([]),[m,C]=a.useState([]),[r,S]=a.useState(null),[l,T]=a.useState([]),[A,u]=a.useState(!0),[x,g]=a.useState(!1);a.useEffect(()=>{o(),h();const e=setInterval(()=>{o(),r&&p(r)},3e4);return()=>clearInterval(e)},[]),a.useEffect(()=>{r&&p(r)},[r]);const o=async()=>{try{const e=await n.get("/temperature-monitoring/alerts/active");w(e.data)}catch(e){console.error("Failed to load active alerts:",e)}},h=async()=>{try{u(!0);const s=(await n.get("/vehicles")).data.map(i=>{var j,y,N,v,_;return{vehicle_id:i.id,vehicle_number:i.plate_number,current_temp_a:(j=i.gps_data)==null?void 0:j.temperature_a,current_temp_b:(y=i.gps_data)==null?void 0:y.temperature_b,status:D((N=i.gps_data)==null?void 0:N.temperature_a,(v=i.gps_data)==null?void 0:v.temperature_b),last_updated:((_=i.gps_data)==null?void 0:_.updated_at)||new Date().toISOString()}});C(s)}catch(e){console.error("Failed to load vehicles:",e)}finally{u(!1)}},p=async e=>{try{const s=await n.get(`/temperature-monitoring/vehicles/${e}/history?hours=24`);T(s.data)}catch(s){console.error("Failed to load temperature history:",s)}},k=async()=>{try{g(!0),await n.post("/temperature-monitoring/collect"),await o(),await h(),alert("ì˜¨ë„ ë°ì´í„° ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(e){console.error("Failed to collect temperature data:",e),alert("ì˜¨ë„ ë°ì´í„° ìˆ˜ì§‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{g(!1)}},L=async e=>{try{await n.post(`/temperature-monitoring/alerts/${e}/resolve`,{notes:"ê´€ë¦¬ìžê°€ ìˆ˜ë™ìœ¼ë¡œ í•´ê²° ì²˜ë¦¬í•¨"}),await o(),alert("ì•Œë¦¼ì´ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(s){console.error("Failed to resolve alert:",s),alert("ì•Œë¦¼ í•´ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},D=(e,s)=>!e&&!s?"normal":e!==void 0&&(e<-25||e>-15)||s!==void 0&&(s<-25||s>-15)?"critical":e!==void 0&&(e<-22||e>-18)||s!==void 0&&(s<-22||s>-18)?"warning":"normal",b=e=>e?e<-18?"text-blue-600":e<5?"text-cyan-600":e<15?"text-green-600":"text-orange-600":"text-gray-500",I=e=>{const s=e==="CRITICAL"?"bg-red-100 text-red-800 border border-red-300":"bg-yellow-100 text-yellow-800 border border-yellow-300";return t.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s}`,children:e==="CRITICAL"?"ðŸš¨ Critical":"âš ï¸  Warning"})},$=e=>e==="critical"?t.jsx(d,{className:"w-5 h-5 text-red-500"}):e==="warning"?t.jsx(d,{className:"w-5 h-5 text-yellow-500"}):t.jsx(Q,{className:"w-5 h-5 text-green-500"}),F={labels:l.filter((e,s)=>s%Math.ceil(l.length/24)===0).map(e=>new Date(e.timestamp).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})),datasets:[{label:"Sensor A",data:l.filter((e,s)=>e.sensor==="A"&&s%Math.ceil(l.length/24)===0).map(e=>e.temperature),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4},{label:"Sensor B",data:l.filter((e,s)=>e.sensor==="B"&&s%Math.ceil(l.length/24)===0).map(e=>e.temperature),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4}]},R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"ì˜¨ë„ ì´ë ¥ (24ì‹œê°„)"}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"ì˜¨ë„ (Â°C)"}}}};return A?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(z,{className:"w-8 h-8 text-blue-600"}),"ì˜¨ë„ ëª¨ë‹ˆí„°ë§"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ì‹¤ì‹œê°„ ì°¨ëŸ‰ ì˜¨ë„ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ê´€ë¦¬"})]}),t.jsxs("button",{onClick:k,disabled:x,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[t.jsx(G,{className:"w-4 h-4"}),x?"ìˆ˜ì§‘ ì¤‘...":"ì˜¨ë„ ë°ì´í„° ìˆ˜ì§‘"]})]}),c.length>0&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(d,{className:"w-5 h-5 text-red-600"}),t.jsxs("h2",{className:"text-lg font-semibold text-red-800",children:["í™œì„± ì•Œë¦¼ (",c.length,")"]})]}),t.jsx("div",{className:"space-y-2",children:c.map(e=>t.jsxs("div",{className:"bg-white rounded-lg p-3 flex justify-between items-center",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[I(e.severity),t.jsx("span",{className:"font-medium",children:e.vehicle_number})]}),t.jsx("p",{className:"text-sm text-gray-700",children:e.message}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.jsx(J,{className:"w-3 h-3 inline mr-1"}),new Date(e.detected_at).toLocaleString("ko-KR")]})]}),t.jsx("button",{onClick:()=>L(e.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"í•´ê²°"})]},e.id))})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ì°¨ëŸ‰ ì˜¨ë„ í˜„í™©"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:m.map(e=>t.jsxs("div",{onClick:()=>S(e.vehicle_id),className:`border rounded-lg p-4 cursor-pointer hover:shadow-lg transition-shadow ${r===e.vehicle_id?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-3",children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.vehicle_number}),$(e.status)]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Sensor A:"}),t.jsx("span",{className:`font-semibold ${b(e.current_temp_a)}`,children:e.current_temp_a!==void 0?`${e.current_temp_a.toFixed(1)}Â°C`:"N/A"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Sensor B:"}),t.jsx("span",{className:`font-semibold ${b(e.current_temp_b)}`,children:e.current_temp_b!==void 0?`${e.current_temp_b.toFixed(1)}Â°C`:"N/A"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("p",{className:"text-xs text-gray-500",children:["ìµœì¢… ì—…ë°ì´íŠ¸: ",new Date(e.last_updated).toLocaleString("ko-KR")]})})]},e.vehicle_id))})]}),r&&l.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["ì˜¨ë„ ì´ë ¥ - ",(f=m.find(e=>e.vehicle_id===r))==null?void 0:f.vehicle_number]}),t.jsx("div",{style:{height:"400px"},children:t.jsx(E,{data:F,options:R})})]})]})};export{se as default};
