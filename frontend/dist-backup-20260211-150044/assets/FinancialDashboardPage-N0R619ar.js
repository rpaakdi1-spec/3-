import{c as M,g as A,r as i,j as e}from"./index-DWrA19-Q.js";import{g as P,a as z,b as K}from"./billing-enhanced-Dk52PFus.js";import{X as O}from"./x-cTU3yyaH.js";import{C as E}from"./calendar-D1aWU6wz.js";import{F as I}from"./file-spreadsheet-ChC5M9z1.js";import{F as R}from"./file-text-DRE6fYJy.js";import{L as W}from"./loader-circle-BPbKe1n-.js";import{D as B}from"./download-Bm7c4jyO.js";import{R as X}from"./refresh-cw-BhCYe8kh.js";import{D as Y}from"./dollar-sign-zNa6eeND.js";import{C as q}from"./credit-card-BfUZ8_y4.js";import{C as w}from"./circle-alert-BFR813J2.js";import{U as N}from"./users-CEPVEgfx.js";import{R as v,o as _,X as k,Y as C,T as F,p as S,B as G,r as H}from"./BarChart-CLbpIxWz.js";import{L as J,a as u}from"./LineChart-07_nQUPD.js";import"./string-BbYD24iH.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],V=M("arrow-up-right",Q),Z="/api/v1",b=A.create({baseURL:Z,headers:{"Content-Type":"application/json"}});b.interceptors.request.use(a=>{const n=localStorage.getItem("token");return n&&(a.headers.Authorization=`Bearer ${n}`),a});const ee=async(a,n)=>{try{const r=await b.post("/api/v1/reports/financial-dashboard/pdf",null,{params:{start_date:a,end_date:n},responseType:"blob",headers:{Accept:"application/pdf"}}),l=new Blob([r.data],{type:"application/pdf"}),d=window.URL.createObjectURL(l),t=document.createElement("a");t.href=d,t.download=`financial_dashboard_${a}_${n}.pdf`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(d),console.log("✅ PDF 리포트 다운로드 완료:",t.download)}catch(r){throw console.error("❌ PDF 다운로드 실패:",r),r}},se=async(a,n)=>{try{const r=await b.post("/api/v1/reports/financial-dashboard/excel",null,{params:{start_date:a,end_date:n},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),l=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(l),t=document.createElement("a");t.href=d,t.download=`financial_dashboard_${a}_${n}.xlsx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(d),console.log("✅ Excel 리포트 다운로드 완료:",t.download)}catch(r){throw console.error("❌ Excel 다운로드 실패:",r),r}},te=({isOpen:a,onClose:n,dateRange:r})=>{const[l,d]=i.useState("excel"),[t,m]=i.useState(!1);if(!a)return null;const h=async()=>{m(!0);try{l==="pdf"?await ee(r.start_date,r.end_date):await se(r.start_date,r.end_date),n()}catch(o){console.error("Failed to download report:",o),alert("리포트 다운로드 실패. 다시 시도해주세요.")}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:n}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"재무 대시보드 리포트 다운로드"}),e.jsx("button",{onClick:n,disabled:t,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:e.jsx(O,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-900",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"리포트 기간"})]}),e.jsxs("p",{className:"mt-2 text-lg font-semibold text-blue-900",children:[r.start_date," ~ ",r.end_date]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"파일 형식 선택"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>d("excel"),disabled:t,className:`p-4 rounded-lg border-2 transition-all disabled:opacity-50 ${l==="excel"?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(I,{className:`w-8 h-8 mx-auto mb-2 ${l==="excel"?"text-green-600":"text-gray-400"}`}),e.jsx("p",{className:`font-medium ${l==="excel"?"text-green-900":"text-gray-700"}`,children:"Excel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:".xlsx"})]}),e.jsxs("button",{onClick:()=>d("pdf"),disabled:t,className:`p-4 rounded-lg border-2 transition-all disabled:opacity-50 ${l==="pdf"?"border-red-500 bg-red-50":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(R,{className:`w-8 h-8 mx-auto mb-2 ${l==="pdf"?"text-red-600":"text-gray-400"}`}),e.jsx("p",{className:`font-medium ${l==="pdf"?"text-red-900":"text-gray-700"}`,children:"PDF"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:".pdf"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"리포트 내용"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),"14개 재무 지표 요약"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),"최근 12개월 월별 추이"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),"Top 10 거래처 목록"]}),l==="excel"&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),"네이티브 Excel 차트 포함"]}),l==="pdf"&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),"한글 폰트 지원"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:n,disabled:t,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"취소"}),e.jsx("button",{onClick:h,disabled:t,className:`px-6 py-2 text-white rounded-lg transition-all disabled:opacity-50 flex items-center gap-2 ${l==="excel"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:t?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 animate-spin"}),"다운로드 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),l==="excel"?"Excel":"PDF"," 다운로드"]})})]})]})})]})},ye=()=>{const[a,n]=i.useState(null),[r,l]=i.useState([]),[d,t]=i.useState([]),[m,h]=i.useState(!1),[o,j]=i.useState({start_date:new Date(new Date().setMonth(new Date().getMonth()-3)).toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0]}),[p,D]=i.useState(12),[L,y]=i.useState(!1);i.useEffect(()=>{f()},[o,p]);const T=s=>({total_revenue:s.total_revenue||0,total_invoiced:s.invoiced_amount||0,total_paid:s.collected_amount||0,total_outstanding:s.total_receivables||0,payment_rate:s.collection_rate||0,overdue_count:s.overdue_count||0,overdue_amount:s.overdue_receivables||0,pending_settlements:s.pending_settlements||0,pending_settlement_amount:s.total_settlements||0,cash_in:s.cash_in||0,cash_out:s.cash_out||0,net_cash_flow:s.net_cash_flow||0}),f=async()=>{h(!0);try{const s=await P(o.start_date,o.end_date),x=T(s);n(x);const $=await z(o.start_date,o.end_date,p);l($);const U=await K(o.start_date,o.end_date,10);t(U)}catch(s){console.error("Failed to load dashboard data:",s)}finally{h(!1)}},c=s=>new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",maximumFractionDigits:0}).format(s),g=s=>`${s.toFixed(1)}%`;return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"재무 대시보드"}),e.jsx("p",{className:"text-gray-600",children:"청구/수금 현황 및 재무 분석"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:f,disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx(X,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"새로고침"]}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"보고서 다운로드"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",value:o.start_date,onChange:s=>j({...o,start_date:s.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("span",{className:"text-gray-500",children:"~"}),e.jsx("input",{type:"date",value:o.end_date,onChange:s=>j({...o,end_date:s.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"총 매출"}),e.jsx(Y,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(a.total_revenue)}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx(V,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-600",children:"전월 대비 +12.5%"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"수금액"}),e.jsx(q,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c(a.total_paid)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["회수율: ",g(a.payment_rate)]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"미수금"}),e.jsx(w,{className:"w-5 h-5 text-orange-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:c(a.total_outstanding)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["연체: ",c(a.overdue_amount)," (",a.overdue_count,"건)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"미지급 정산"}),e.jsx(N,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c(a.pending_settlement_amount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[a.pending_settlements,"건 대기중"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"월별 매출 추이"}),e.jsxs("select",{value:p,onChange:s=>D(Number(s.target.value)),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:3,children:"최근 3개월"}),e.jsx("option",{value:6,children:"최근 6개월"}),e.jsx("option",{value:12,children:"최근 12개월"})]})]}),e.jsx(v,{width:"100%",height:300,children:e.jsxs(J,{data:r,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(k,{dataKey:"month",stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(C,{stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(F,{contentStyle:{backgroundColor:"#FFF",border:"1px solid #E5E7EB",borderRadius:"8px"},formatter:s=>c(s)}),e.jsx(S,{}),e.jsx(u,{type:"monotone",dataKey:"revenue",stroke:"#3B82F6",strokeWidth:2,name:"매출"}),e.jsx(u,{type:"monotone",dataKey:"paid",stroke:"#10B981",strokeWidth:2,name:"수금"}),e.jsx(u,{type:"monotone",dataKey:"outstanding",stroke:"#F59E0B",strokeWidth:2,name:"미수"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"월별 회수율"}),e.jsx(v,{width:"100%",height:300,children:e.jsxs(G,{data:r,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(k,{dataKey:"month",stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(C,{stroke:"#6B7280",style:{fontSize:"12px"}}),e.jsx(F,{contentStyle:{backgroundColor:"#FFF",border:"1px solid #E5E7EB",borderRadius:"8px"},formatter:s=>g(s)}),e.jsx(S,{}),e.jsx(H,{dataKey:"payment_rate",fill:"#10B981",name:"회수율 (%)"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"주요 거래처 TOP 10"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"순위"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"거래처명"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"총 청구액"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수금액"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"미수금"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"청구 건수"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"회수율"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map((s,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold ${x===0?"bg-yellow-100 text-yellow-800":x===1?"bg-gray-100 text-gray-800":x===2?"bg-orange-100 text-orange-800":"bg-blue-50 text-blue-800"}`,children:x+1})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.client_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:c(s.total_amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-green-600",children:c(s.paid_amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-orange-600",children:c(s.outstanding_amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[s.invoice_count,"건"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:`text-sm font-medium ${s.payment_rate>=90?"text-green-600":s.payment_rate>=70?"text-yellow-600":"text-red-600"}`,children:g(s.payment_rate)})})]},s.client_id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{className:"bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow text-left",children:[e.jsx(R,{className:"w-8 h-8 text-blue-500 mb-3"}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"청구서 생성"}),e.jsx("p",{className:"text-sm text-gray-600",children:"월간 청구서 일괄 생성"})]}),e.jsxs("button",{className:"bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow text-left",children:[e.jsx(w,{className:"w-8 h-8 text-orange-500 mb-3"}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"연체 관리"}),e.jsx("p",{className:"text-sm text-gray-600",children:"연체 청구서 알림 발송"})]}),e.jsxs("button",{className:"bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow text-left",children:[e.jsx(N,{className:"w-8 h-8 text-purple-500 mb-3"}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"정산 처리"}),e.jsx("p",{className:"text-sm text-gray-600",children:"기사 정산 승인/지급"})]})]})]}),e.jsx(te,{isOpen:L,onClose:()=>y(!1),dateRange:o})]})};export{ye as default};
