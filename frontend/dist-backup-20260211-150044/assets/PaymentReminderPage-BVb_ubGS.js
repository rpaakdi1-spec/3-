import{r as c,j as e}from"./index-DWrA19-Q.js";import{k as C,s as E,l as _,m as D}from"./billing-enhanced-Dk52PFus.js";import{R as M}from"./refresh-cw-BhCYe8kh.js";import{S as k}from"./send-CXNSCKT6.js";import{P as L}from"./plus-Bbj8i8yA.js";import{B as x}from"./bell-Muzov4ul.js";import{C as h}from"./circle-check-big-CgFKxf-k.js";import{C as p}from"./clock-DDHN8A9u.js";import{C as g}from"./circle-x-CBGg8NKM.js";import{T as P}from"./trash-2-D1AjY7Me.js";import{M as I}from"./message-square-CQX4xtvJ.js";import{M as R}from"./mail-BajueKOj.js";const K=()=>{const[a,u]=c.useState([]),[i,o]=c.useState(!1),[f,d]=c.useState(!1),[t,l]=c.useState({invoice_id:0,reminder_type:"DUE_DATE",channel:"EMAIL",scheduled_at:new Date().toISOString().split("T")[0],message:""});c.useEffect(()=>{r()},[]);const r=async()=>{o(!0);try{const s=await C();u(s)}catch(s){console.error("Failed to load reminders:",s)}finally{o(!1)}},j=async()=>{try{await D(t),d(!1),l({invoice_id:0,reminder_type:"DUE_DATE",channel:"EMAIL",scheduled_at:new Date().toISOString().split("T")[0],message:""}),r(),alert("결제 알림이 생성되었습니다.")}catch(s){console.error("Failed to create reminder:",s),alert("알림 생성에 실패했습니다.")}},y=async()=>{if(confirm("납기일 도래 알림을 일괄 발송하시겠습니까?"))try{await E(),alert("납기일 알림이 발송되었습니다."),r()}catch(s){console.error("Failed to send reminders:",s),alert("알림 발송에 실패했습니다.")}},b=async s=>{if(confirm("정말 삭제하시겠습니까?"))try{await _(s),r()}catch(n){console.error("Failed to delete reminder:",n)}},m=s=>new Date(s).toLocaleString("ko-KR"),N=s=>{switch(s){case"EMAIL":return e.jsx(R,{className:"w-4 h-4"});case"SMS":return e.jsx(I,{className:"w-4 h-4"});case"PUSH":return e.jsx(x,{className:"w-4 h-4"});default:return e.jsx(x,{className:"w-4 h-4"})}},w=s=>({EMAIL:"이메일",SMS:"SMS",PUSH:"푸시 알림"})[s]||s,v=s=>({DUE_DATE:"납기일",OVERDUE:"연체",FOLLOW_UP:"후속",CUSTOM:"사용자 정의"})[s]||s,S=(s,n)=>s==="SENT"&&n?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(h,{className:"w-3 h-3"}),"발송됨"]}):s==="FAILED"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(g,{className:"w-3 h-3"}),"실패"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(p,{className:"w-3 h-3"}),"대기 중"]});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"결제 알림 관리"}),e.jsx("p",{className:"text-gray-600",children:"자동 결제 알림 발송 및 관리"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:r,disabled:i,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx(M,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"새로고침"]}),e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"납기일 알림 발송"]}),e.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"알림 추가"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(x,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 알림"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발송 완료"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.filter(s=>s.status==="SENT").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:e.jsx(p,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기 중"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:a.filter(s=>s.status==="PENDING").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"실패"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.filter(s=>s.status==="FAILED").length})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"청구서"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"거래처"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"알림 유형"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"채널"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"예정일"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"발송일"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"상태"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.invoice_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:s.client_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:v(s.reminder_type)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-900",children:[N(s.channel),w(s.channel)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:m(s.scheduled_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:s.sent_at?m(s.sent_at):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:S(s.status,s.sent_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.status==="PENDING"&&e.jsx("button",{onClick:()=>b(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(P,{className:"w-4 h-4"})})})]},s.id))})]})}),a.length===0&&!i&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"등록된 결제 알림이 없습니다."})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"결제 알림 추가"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"청구서 ID"}),e.jsx("input",{type:"number",value:t.invoice_id||"",onChange:s=>l({...t,invoice_id:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"알림 유형"}),e.jsxs("select",{value:t.reminder_type,onChange:s=>l({...t,reminder_type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"DUE_DATE",children:"납기일"}),e.jsx("option",{value:"OVERDUE",children:"연체"}),e.jsx("option",{value:"FOLLOW_UP",children:"후속"}),e.jsx("option",{value:"CUSTOM",children:"사용자 정의"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"발송 채널"}),e.jsxs("select",{value:t.channel,onChange:s=>l({...t,channel:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"EMAIL",children:"이메일"}),e.jsx("option",{value:"SMS",children:"SMS"}),e.jsx("option",{value:"PUSH",children:"푸시 알림"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"발송 예정일"}),e.jsx("input",{type:"date",value:t.scheduled_at,onChange:s=>l({...t,scheduled_at:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"메시지 (선택)"}),e.jsx("textarea",{value:t.message,onChange:s=>l({...t,message:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"알림 메시지를 입력하세요..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:j,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"생성"})]})]})})]})})};export{K as default};
