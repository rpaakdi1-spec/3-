import{c as K,r as l,n as c,j as e,L as M,B as h}from"./index-DWrA19-Q.js";import{L as S}from"./Layout-_7QmQsM4.js";import{C as o}from"./Card-BZBkuSEa.js";import{B as $}from"./brain-BT-kJAZk.js";import{C}from"./circle-check-big-CgFKxf-k.js";import{F as j}from"./file-spreadsheet-ChC5M9z1.js";import{D as H}from"./download-Bm7c4jyO.js";import{U as T}from"./upload-DeGKjjpU.js";import{C as V}from"./circle-alert-BFR813J2.js";import{P as J}from"./play-o5nkavRb.js";import{T as q}from"./trending-up-B_M0jfMY.js";import"./Sidebar-DEFpisEa.js";import"./package-CyltdJ0k.js";import"./calendar-D1aWU6wz.js";import"./message-square-CQX4xtvJ.js";import"./zap-BDAzIdEF.js";import"./dollar-sign-zNa6eeND.js";import"./activity-B0jPijYH.js";import"./truck-DYyomFIS.js";import"./thermometer-C21NQbKK.js";import"./chart-column-BBu1zpkI.js";import"./calculator-Cr8S2iSR.js";import"./clock-DDHN8A9u.js";import"./bell-Muzov4ul.js";import"./wrench-IdkLiNsk.js";import"./settings-M2ZQNpfd.js";import"./x-cTU3yyaH.js";import"./chevron-down-DjioDqHQ.js";import"./index-BvcQtAB6.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Q=K("database",G),_e=()=>{var z,_,k;const[A,u]=l.useState(!0),[g,y]=l.useState(!1),[m,f]=l.useState(!1),[x,I]=l.useState([]),[i,L]=l.useState(null),[d,R]=l.useState(null),[a,b]=l.useState(null),[N,D]=l.useState("dispatch"),[v,U]=l.useState(10),[w,F]=l.useState(32);l.useEffect(()=>{p()},[]);const p=async()=>{try{u(!0);const t=await(await fetch("/api/v1/ml/training/status")).json();L(t);const n=await(await fetch("/api/v1/ml/training/history")).json();I(n.files||[])}catch(s){console.error("Failed to fetch training data:",s),c.error("데이터를 불러오는데 실패했습니다")}finally{u(!1)}},B=async()=>{try{const t=await(await fetch("/api/v1/ml/training/template/download")).blob(),r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="AI학습데이터_template.xlsx",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n),c.success("템플릿이 다운로드되었습니다")}catch(s){console.error("Failed to download template:",s),c.error("템플릿 다운로드에 실패했습니다")}},E=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];t&&(R(t),b(null))},P=async()=>{if(!d){c.error("파일을 선택해주세요");return}const s=new FormData;s.append("file",d);try{y(!0);const t=await fetch("/api/v1/ml/training/upload",{method:"POST",body:s});if(!t.ok){const n=await t.json();throw new Error(n.detail||"업로드 실패")}const r=await t.json();b(r),c.success(`${r.valid_rows}건의 데이터가 업로드되었습니다`),p()}catch(t){console.error("Upload failed:",t),c.error(t.message||"업로드에 실패했습니다")}finally{y(!1)}},O=async()=>{if(!a&&x.length===0){c.error("먼저 학습 데이터를 업로드해주세요");return}try{f(!0);const s=await fetch("/api/v1/ml/training/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model_type:N,epochs:v,batch_size:w})});if(!s.ok){const r=await s.json();throw new Error(r.detail||"학습 시작 실패")}const t=await s.json();c.success(`AI 학습이 완료되었습니다!
학습 데이터: ${t.training_data_count}건`),p()}catch(s){console.error("Training failed:",s),c.error(s.message||"학습에 실패했습니다")}finally{f(!1)}};return A?e.jsx(S,{children:e.jsx(M,{})}):e.jsx(S,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center",children:[e.jsx($,{className:"mr-3 text-blue-600",size:36}),"AI 모델 학습"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"배차 데이터를 업로드하고 AI 모델을 학습시킵니다"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"학습된 모델"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:((z=i==null?void 0:i.dispatch_optimizer)==null?void 0:z.status)==="trained"?"✅ 완료":"❌ 미학습"}),((_=i==null?void 0:i.dispatch_optimizer)==null?void 0:_.trained_at)&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(i.dispatch_optimizer.trained_at).toLocaleString("ko-KR")})]}),e.jsx(C,{className:"text-green-500",size:48})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"학습 데이터"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[((k=i==null?void 0:i.dispatch_optimizer)==null?void 0:k.data_count)||0,"건"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"사용된 데이터"})]}),e.jsx(Q,{className:"text-blue-500",size:48})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"업로드된 파일"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[x.length,"개"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"학습 데이터 파일"})]}),e.jsx(j,{className:"text-purple-500",size:48})]})})]}),e.jsxs(o,{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3",children:"1"}),"템플릿 다운로드"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"AI 학습에 필요한 엑셀 템플릿을 다운로드하세요. 템플릿에는 샘플 데이터와 필드 설명이 포함되어 있습니다."}),e.jsxs(h,{onClick:B,variant:"primary",children:[e.jsx(H,{size:18,className:"mr-2"}),"AI 학습 템플릿 다운로드"]})]}),e.jsxs(o,{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3",children:"2"}),"학습 데이터 업로드"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"작성한 엑셀 파일을 업로드하세요. 거리와 소요시간은 네이버 지도 API로 자동 계산됩니다."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:E,className:"hidden"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition-colors",children:d?e.jsxs("div",{children:[e.jsx(j,{size:48,className:"mx-auto text-green-600 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:d.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(d.size/1024).toFixed(2)," KB"]})]}):e.jsxs("div",{children:[e.jsx(T,{size:48,className:"mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"클릭하여 파일 선택"}),e.jsx("p",{className:"text-xs text-gray-500",children:".xlsx, .xls 파일만 가능"})]})})]}),e.jsxs(h,{onClick:P,disabled:!d||g,variant:"primary",children:[e.jsx(T,{size:18,className:"mr-2"}),g?"업로드 중...":"업로드"]})]}),a&&e.jsx("div",{className:`mt-4 p-4 rounded-lg ${a.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[a.success?e.jsx(C,{className:"text-green-600 mr-3 flex-shrink-0",size:24}):e.jsx(V,{className:"text-red-600 mr-3 flex-shrink-0",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${a.success?"text-green-800":"text-red-800"}`,children:a.message}),e.jsxs("div",{className:"mt-2 text-sm space-y-1",children:[e.jsxs("p",{children:["총 데이터: ",a.total_rows,"건"]}),e.jsxs("p",{className:"text-green-700",children:["✓ 유효: ",a.valid_rows,"건"]}),a.error_rows>0&&e.jsxs("p",{className:"text-red-700",children:["✗ 오류: ",a.error_rows,"건"]})]}),a.errors&&a.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600 font-semibold",children:"오류 목록:"}),e.jsx("ul",{className:"text-xs text-gray-600 list-disc list-inside",children:a.errors.map((s,t)=>e.jsx("li",{children:s},t))})]})]})]})})]}),e.jsxs(o,{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx("span",{className:"bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3",children:"3"}),"AI 학습 시작"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"학습 설정을 확인하고 AI 모델 학습을 시작하세요."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"모델 종류"}),e.jsxs("select",{value:N,onChange:s=>D(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dispatch",children:"배차 최적화"}),e.jsx("option",{value:"demand",children:"수요 예측"}),e.jsx("option",{value:"failure",children:"고장 예측"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Epochs (반복 횟수)"}),e.jsx("input",{type:"number",value:v,onChange:s=>U(parseInt(s.target.value)),min:"1",max:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch Size"}),e.jsx("input",{type:"number",value:w,onChange:s=>F(parseInt(s.target.value)),min:"1",max:"256",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs(h,{onClick:O,disabled:m||!a&&x.length===0,variant:"primary",className:"w-full py-3 text-lg",children:[e.jsx(J,{size:24,className:"mr-2"}),m?"학습 중...":"AI 학습 시작"]}),m&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"AI 모델을 학습하고 있습니다..."})]})]}),e.jsxs(o,{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(q,{className:"mr-3 text-blue-600",size:24}),"학습 이력"]}),x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"파일명"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"업로드 시간"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"파일 크기"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"데이터 건수"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:s.filename}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(s.uploaded_at).toLocaleString("ko-KR")}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[s.file_size_kb.toFixed(2)," KB"]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[s.data_count,"건"]})]},t))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"학습 이력이 없습니다"}),e.jsx("p",{className:"text-sm text-gray-500",children:"먼저 학습 데이터를 업로드해주세요"})]})]})]})})};export{_e as default};
