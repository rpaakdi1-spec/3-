import{r as n,g as d,j as e,T as S}from"./index-DWrA19-Q.js";import{F as h}from"./file-text-DRE6fYJy.js";import{C as j}from"./circle-check-big-CgFKxf-k.js";import{S as C}from"./send-CXNSCKT6.js";import{C as z}from"./credit-card-BfUZ8_y4.js";import{U as M}from"./user-C9_NANMn.js";import{S as Y}from"./search-DqRrbLlx.js";import{R as V}from"./refresh-cw-BhCYe8kh.js";import{D as G}from"./download-Bm7c4jyO.js";import{M as K}from"./mail-BajueKOj.js";import{D}from"./dollar-sign-zNa6eeND.js";import{C as R}from"./clock-DDHN8A9u.js";const x="/api/v1",le=()=>{const[l,p]=n.useState("invoices"),[k,F]=n.useState([]),[A,E]=n.useState([]),[o,L]=n.useState(null),[y,N]=n.useState(!1),[m,I]=n.useState(""),[u,$]=n.useState("all"),[c,f]=n.useState({start:new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]});n.useEffect(()=>{g()},[l,c]);const g=async()=>{N(!0);try{const t={Authorization:`Bearer ${localStorage.getItem("access_token")}`};if(l==="invoices"){const a=await d.get(`${x}/billing/invoices`,{headers:t,params:{limit:100}});F(a.data);const i=await d.get(`${x}/billing/invoices/summary`,{headers:t,params:{start_date:c.start,end_date:c.end}});L(i.data)}else if(l==="settlements"){const a=await d.get(`${x}/billing/settlements`,{headers:t,params:{limit:100}});E(a.data)}}catch(s){console.error("Failed to load data:",s)}finally{N(!1)}},T=async s=>{try{const t=localStorage.getItem("access_token");await d.post(`${x}/billing/invoices/${s}/send`,{},{headers:{Authorization:`Bearer ${t}`}}),alert("청구서가 발송되었습니다."),g()}catch(t){console.error("Failed to send invoice:",t),alert("청구서 발송에 실패했습니다.")}},P=async(s,t)=>{try{const a=localStorage.getItem("access_token"),i=await d.get(`${x}/billing/invoices/${s}/pdf`,{headers:{Authorization:`Bearer ${a}`},responseType:"blob"}),O=new Blob([i.data],{type:"application/pdf"}),_=window.URL.createObjectURL(O),b=document.createElement("a");b.href=_,b.download=`${t}.pdf`,b.click(),window.URL.revokeObjectURL(_)}catch(a){console.error("Failed to download PDF:",a),alert("PDF 다운로드에 실패했습니다.")}},U=async s=>{const t=prompt("결제 금액을 입력하세요:");if(!t)return;const a=prompt("결제 날짜 (YYYY-MM-DD):",new Date().toISOString().split("T")[0]);if(a)try{const i=localStorage.getItem("access_token");await d.post(`${x}/billing/payments`,{invoice_id:s,amount:parseFloat(t),payment_method:"TRANSFER",payment_date:a},{headers:{Authorization:`Bearer ${i}`}}),alert("결제가 기록되었습니다."),g()}catch(i){console.error("Failed to record payment:",i),alert("결제 기록에 실패했습니다.")}},B=s=>{const t={DRAFT:{label:"초안",color:"bg-gray-100 text-gray-800",icon:e.jsx(h,{className:"w-3 h-3"})},PENDING:{label:"대기",color:"bg-yellow-100 text-yellow-800",icon:e.jsx(R,{className:"w-3 h-3"})},SENT:{label:"발송됨",color:"bg-blue-100 text-blue-800",icon:e.jsx(C,{className:"w-3 h-3"})},PARTIAL:{label:"부분결제",color:"bg-orange-100 text-orange-800",icon:e.jsx(D,{className:"w-3 h-3"})},PAID:{label:"결제완료",color:"bg-green-100 text-green-800",icon:e.jsx(j,{className:"w-3 h-3"})},OVERDUE:{label:"연체",color:"bg-red-100 text-red-800",icon:e.jsx(S,{className:"w-3 h-3"})},CANCELLED:{label:"취소",color:"bg-gray-100 text-gray-600",icon:e.jsx(h,{className:"w-3 h-3"})}},a=t[s]||t.DRAFT;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:[a.icon,a.label]})},r=s=>new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(s),v=k.filter(s=>{const t=s.invoice_number.toLowerCase().includes(m.toLowerCase())||s.client.name.toLowerCase().includes(m.toLowerCase()),a=u==="all"||s.status===u;return t&&a}),w=A.filter(s=>s.settlement_number.toLowerCase().includes(m.toLowerCase())||s.driver.name.toLowerCase().includes(m.toLowerCase()));return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"청구/정산 관리"}),e.jsx("p",{className:"text-gray-600",children:"거래처 청구서 및 기사 정산 자동화"})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"총 청구액"}),e.jsx(h,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r(o.total_amount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o.total_invoices,"건"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"결제 완료"}),e.jsx(j,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r(o.paid_amount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o.payment_rate.toFixed(1),"% 회수율"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"미수금"}),e.jsx(S,{className:"w-5 h-5 text-orange-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r(o.outstanding_amount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o.status_breakdown.OVERDUE||0,"건 연체"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"청구서 발송"}),e.jsx(C,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.status_breakdown.SENT||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"대기 중"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>p("invoices"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${l==="invoices"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"거래처 청구서"]})}),e.jsx("button",{onClick:()=>p("payments"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${l==="payments"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"결제 내역"]})}),e.jsx("button",{onClick:()=>p("settlements"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${l==="settlements"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"기사 정산"]})})]})}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"검색...",value:m,onChange:s=>I(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),l==="invoices"&&e.jsxs("select",{value:u,onChange:s=>$(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"전체 상태"}),e.jsx("option",{value:"DRAFT",children:"초안"}),e.jsx("option",{value:"PENDING",children:"대기"}),e.jsx("option",{value:"SENT",children:"발송됨"}),e.jsx("option",{value:"PARTIAL",children:"부분결제"}),e.jsx("option",{value:"PAID",children:"결제완료"}),e.jsx("option",{value:"OVERDUE",children:"연체"})]}),e.jsx("input",{type:"date",value:c.start,onChange:s=>f({...c,start:s.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("input",{type:"date",value:c.end,onChange:s=>f({...c,end:s.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{onClick:g,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 flex items-center justify-center gap-2",children:[e.jsx(V,{className:`w-4 h-4 ${y?"animate-spin":""}`}),"새로고침"]})]})}),e.jsxs("div",{className:"p-6",children:[l==="invoices"&&e.jsx("div",{className:"space-y-4",children:v.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"청구서가 없습니다."}):v.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.invoice_number}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.client.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["청구 기간: ",s.billing_period_start," ~ ",s.billing_period_end]})]}),e.jsxs("div",{className:"text-right",children:[B(s.status),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:r(s.total_amount)}),s.paid_amount>0&&e.jsxs("p",{className:"text-sm text-green-600",children:["결제: ",r(s.paid_amount)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"발행일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.issue_date})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"납기일:"}),e.jsx("span",{className:"ml-2 text-gray-900 font-medium",children:s.due_date})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"소계:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r(s.subtotal)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"부가세:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r(s.tax_amount)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>P(s.id,s.invoice_number),className:"px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),"PDF"]}),s.status!=="PAID"&&s.status!=="CANCELLED"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>T(s.id),className:"px-3 py-1.5 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"이메일 발송"]}),e.jsxs("button",{onClick:()=>U(s.id),className:"px-3 py-1.5 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),"결제 기록"]})]})]})]},s.id))}),l==="settlements"&&e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"정산 내역이 없습니다."}):w.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.settlement_number}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.driver.name," 기사"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["정산 기간: ",s.settlement_period_start," ~ ",s.settlement_period_end]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${s.is_paid?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.is_paid?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-3 h-3"}),"지급완료"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"미지급"]})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:r(s.net_amount)}),e.jsx("p",{className:"text-sm text-gray-500",children:"순액"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"총 매출:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r(s.total_revenue)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"수수료:"}),e.jsxs("span",{className:"ml-2 text-red-600",children:["-",r(s.commission_amount)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"배차 건수:"}),e.jsxs("span",{className:"ml-2 text-gray-900",children:[s.dispatch_count,"건"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:s.is_paid?"지급일:":"정산 대기"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.paid_date||"-"})]})]})]},s.id))})]})]})]})})};export{le as default};
