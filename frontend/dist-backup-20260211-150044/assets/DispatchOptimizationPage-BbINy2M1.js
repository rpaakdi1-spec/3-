import{r as i,g as N,j as e}from"./index-DWrA19-Q.js";import{T as o}from"./truck-DYyomFIS.js";import{S as L}from"./settings-M2ZQNpfd.js";import{R as K}from"./refresh-cw-BhCYe8kh.js";import{C as E}from"./circle-play-WfgGomtv.js";import{C as q}from"./calendar-D1aWU6wz.js";import{C as z}from"./clock-DDHN8A9u.js";import{P as F}from"./package-CyltdJ0k.js";import{M as f}from"./map-pin-BXKaUHvy.js";import{T as g}from"./trending-down-CT6h8If0.js";import{D as G}from"./dollar-sign-zNa6eeND.js";import{C as U}from"./chart-column-BBu1zpkI.js";import{R as M,B as X,o as Y,X as V,Y as H,T as I,p as J,r as v,q as Q}from"./BarChart-CLbpIxWz.js";import{P as W,a as Z}from"./PieChart-BVQ5u61z.js";import{C as ee}from"./circle-check-big-CgFKxf-k.js";import"./string-BbYD24iH.js";const _="/api/v1",ye=()=>{const[se,ae]=i.useState(!1),[u,w]=i.useState(!1),[a,k]=i.useState(null),[r,C]=i.useState(null),[c,x]=i.useState("routes"),[n,S]=i.useState({max_vehicles:10,max_route_time:480,priority_orders:[],excluded_vehicles:[]}),[d,p]=i.useState({use_traffic_data:!0,optimize_fuel:!0,balance_workload:!0}),[m,A]=i.useState([]),[b,D]=i.useState(new Date().toISOString().split("T")[0]);i.useEffect(()=>{O()},[b]);const O=async()=>{var s;try{const t=localStorage.getItem("access_token"),y=((s=(await N.get(`${_}/orders`,{headers:{Authorization:`Bearer ${t}`},params:{status:"CONFIRMED",limit:100}})).data.orders)==null?void 0:s.map(B=>B.id))||[];A(y)}catch(t){console.error("Failed to load orders:",t)}},P=async()=>{var s,t;if(m.length===0){alert("배차할 주문을 선택해주세요");return}w(!0);try{const l=localStorage.getItem("access_token"),y=await N.post(`${_}/dispatch-optimization/optimize`,{order_ids:m,date:b,constraints:n,options:d},{headers:{Authorization:`Bearer ${l}`}});k(y.data),x("routes")}catch(l){console.error("Optimization failed:",l),alert(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.detail)||"최적화 실패")}finally{w(!1)}},T=async()=>{if(a)try{const s=localStorage.getItem("access_token");await N.post(`${_}/dispatch-optimization/${a.optimization_id}/approve`,{approved_by:1,notes:"승인함"},{headers:{Authorization:`Bearer ${s}`}}),alert("배차가 승인되었습니다!")}catch(s){console.error("Approval failed:",s),alert("승인 실패")}},h=s=>`₩${s.toLocaleString()}`,j=s=>{const t=Math.floor(s/60),l=s%60;return`${t}시간 ${l}분`},R=()=>{if(!a)return[];const s={distance:a.summary.total_distance/(1+a.summary.improvement_vs_manual.distance/100),time:a.summary.total_time/(1+a.summary.improvement_vs_manual.time/100),cost:a.summary.estimated_cost/(1+a.summary.improvement_vs_manual.cost/a.summary.estimated_cost)};return[{name:"수동 배차",거리:Math.round(s.distance),시간:Math.round(s.time),비용:Math.round(s.cost/1e3)},{name:"AI 최적화",거리:Math.round(a.summary.total_distance),시간:a.summary.total_time,비용:Math.round(a.summary.estimated_cost/1e3)}]},$=()=>a?[{name:"사용",value:a.summary.total_vehicles,color:"#10b981"},{name:"미사용",value:n.max_vehicles-a.summary.total_vehicles,color:"#e5e7eb"}]:[];return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-blue-600"}),"자동 배차 최적화"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AI 기반 다중 차량 경로 최적화 시스템"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),"최적화 설정"]}),e.jsx("button",{onClick:P,disabled:u||m.length===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 disabled:bg-gray-400",children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 animate-spin"}),"최적화 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4"}),"최적화 실행"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"배차 날짜"]}),e.jsx("input",{type:"date",value:b,onChange:s=>D(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(o,{className:"w-4 h-4 inline mr-1"}),"최대 차량 수"]}),e.jsx("input",{type:"number",value:n.max_vehicles,onChange:s=>S({...n,max_vehicles:parseInt(s.target.value)}),min:"1",max:"20",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(z,{className:"w-4 h-4 inline mr-1"}),"최대 경로 시간 (분)"]}),e.jsx("input",{type:"number",value:n.max_route_time,onChange:s=>S({...n,max_route_time:parseInt(s.target.value)}),min:"60",max:"600",step:"30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1"}),"선택된 주문"]}),e.jsx("div",{className:"px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[m.length,"건"]})})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.use_traffic_data,onChange:s=>p({...d,use_traffic_data:s.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"실시간 교통 정보 사용"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.optimize_fuel,onChange:s=>p({...d,optimize_fuel:s.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"연료 최적화"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.balance_workload,onChange:s=>p({...d,balance_workload:s.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"업무량 균등 배분"})]})]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"사용 차량"}),e.jsx(o,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[a.summary.total_vehicles,"대"]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[n.max_vehicles-a.summary.total_vehicles,"대 절감"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"배정 주문"}),e.jsx(F,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[a.summary.total_orders,"건"]}),a.summary.unassigned_orders>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:[a.summary.unassigned_orders,"건 미배정"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"총 거리"}),e.jsx(f,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[a.summary.total_distance.toFixed(1),"km"]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),Math.abs(a.summary.improvement_vs_manual.distance).toFixed(1),"% 단축"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"총 시간"}),e.jsx(z,{className:"w-5 h-5 text-orange-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j(a.summary.total_time)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),Math.abs(a.summary.improvement_vs_manual.time).toFixed(1),"% 단축"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"예상 비용"}),e.jsx(G,{className:"w-5 h-5 text-red-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h(a.summary.estimated_cost)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[h(Math.abs(a.summary.improvement_vs_manual.cost))," 절감"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-4 px-6",children:[e.jsxs("button",{onClick:()=>x("routes"),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${c==="routes"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(o,{className:"w-4 h-4 inline mr-2"}),"경로 목록"]}),e.jsxs("button",{onClick:()=>x("map"),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${c==="map"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),"지도 시각화"]}),e.jsxs("button",{onClick:()=>x("performance"),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${c==="performance"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(U,{className:"w-4 h-4 inline mr-2"}),"성과 비교"]})]})}),e.jsxs("div",{className:"p-6",children:[c==="routes"&&e.jsx("div",{className:"space-y-4",children:a.routes.map(s=>e.jsx("div",{onClick:()=>C(s),className:`border rounded-lg p-4 cursor-pointer transition-all ${(r==null?void 0:r.route_id)===s.route_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:["경로 #",s.route_id,e.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["차량 #",s.vehicle_id," | 운전자 #",s.driver_id]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-3",children:[e.jsxs("div",{className:"bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"배송 건수"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[s.orders.length,"건"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"거리"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[s.total_distance.toFixed(1),"km"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"시간"}),e.jsx("p",{className:"font-bold text-gray-900",children:j(s.total_time)})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"적재량"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[s.total_load_weight.toFixed(1),"톤"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"비용"}),e.jsx("p",{className:"font-bold text-gray-900",children:h(s.estimated_cost)})]})]})]})})},s.route_id))}),c==="map"&&e.jsxs("div",{className:"bg-gray-100 rounded-lg p-8 text-center",children:[e.jsx(f,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"지도 시각화"}),e.jsx("p",{className:"text-gray-600",children:"각 경로를 지도에 표시합니다"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Leaflet 또는 Google Maps API 연동으로 구현 예정"})]}),c==="performance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"수동 배차 vs AI 최적화"}),e.jsx(M,{width:"100%",height:300,children:e.jsxs(X,{data:R(),children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"name"}),e.jsx(H,{}),e.jsx(I,{}),e.jsx(J,{}),e.jsx(v,{dataKey:"거리",fill:"#8b5cf6",name:"거리 (km)"}),e.jsx(v,{dataKey:"시간",fill:"#10b981",name:"시간 (분)"}),e.jsx(v,{dataKey:"비용",fill:"#f59e0b",name:"비용 (천원)"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"차량 사용률"}),e.jsx(M,{width:"100%",height:250,children:e.jsxs(W,{children:[e.jsx(Z,{data:$(),cx:"50%",cy:"50%",labelLine:!1,label:({name:s,value:t})=>`${s}: ${t}대`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:$().map((s,t)=>e.jsx(Q,{fill:s.color},`cell-${t}`))}),e.jsx(I,{})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"개선 지표"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"거리 단축"}),e.jsxs("span",{className:"font-bold text-green-600 flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4"}),Math.abs(a.summary.improvement_vs_manual.distance).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"시간 단축"}),e.jsxs("span",{className:"font-bold text-green-600 flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4"}),Math.abs(a.summary.improvement_vs_manual.time).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"비용 절감"}),e.jsx("span",{className:"font-bold text-green-600",children:h(Math.abs(a.summary.improvement_vs_manual.cost))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"최적화 시간"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[a.summary.optimization_time.toFixed(1),"초"]})]})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>k(null),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"초기화"}),e.jsxs("button",{onClick:T,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"배차 승인"]})]})]}),!a&&!u&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(o,{className:"w-20 h-20 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"배차 최적화 준비 완료"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"설정을 확인하고 '최적화 실행' 버튼을 클릭하세요"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["✓ ",m.length,"개 주문 대기 중"]}),e.jsxs("p",{children:["✓ 최대 ",n.max_vehicles,"대 차량 사용 가능"]}),e.jsxs("p",{children:["✓ 경로당 최대 ",j(n.max_route_time)]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["경로 #",r.route_id," 상세"]}),e.jsx("button",{onClick:()=>C(null),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"차량"}),e.jsxs("p",{className:"font-bold text-gray-900",children:["#",r.vehicle_id]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"운전자"}),e.jsxs("p",{className:"font-bold text-gray-900",children:["#",r.driver_id]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"배송"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[r.orders.length,"건"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"거리"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[r.total_distance.toFixed(1),"km"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"배송 순서"}),e.jsx("div",{className:"space-y-2",children:r.sequence.map((s,t)=>{var l;return e.jsx("div",{className:`p-3 rounded-lg border ${s.type==="depot"?"bg-blue-50 border-blue-200":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.type==="depot"?"창고 출발/도착":`배송 - 주문 #${s.order_id}`}),e.jsx("span",{className:"text-sm text-gray-600",children:s.arrival_time})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.location.address||`${s.location.latitude.toFixed(4)}, ${s.location.longitude.toFixed(4)}`}),s.type==="delivery"&&e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["서비스: ",s.service_time,"분"]}),e.jsxs("span",{children:["출발: ",s.departure_time]}),e.jsxs("span",{children:["적재: ",(l=s.load_weight)==null?void 0:l.toFixed(1),"톤"]})]})]})]})},t)})})]})]})]})})]})})};export{ye as default};
