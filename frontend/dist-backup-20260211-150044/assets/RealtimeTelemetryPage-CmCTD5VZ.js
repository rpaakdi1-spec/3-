import{c as u,r,g as F,j as e,T as p}from"./index-DWrA19-Q.js";import{A as f}from"./activity-B0jPijYH.js";import{R as v}from"./refresh-cw-BhCYe8kh.js";import{M as n}from"./map-pin-BXKaUHvy.js";import{C as M}from"./circle-play-WfgGomtv.js";import{C as L}from"./circle-stop-CVy-cL9W.js";import{C as P}from"./circle-check-big-CgFKxf-k.js";import{C as w}from"./clock-DDHN8A9u.js";import{T as E}from"./thermometer-C21NQbKK.js";import{T as U}from"./trending-up-B_M0jfMY.js";import{Z as z}from"./zap-BDAzIdEF.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],_=u("circle",D);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5",key:"1wtuz0"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16",key:"e09ifn"}],["path",{d:"M2 21h13",key:"1x0fut"}],["path",{d:"M3 9h11",key:"1p7c0w"}]],V=u("fuel",O);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],G=u("gauge",B),k="/api/v1",K=k.replace("http","ws"),le=()=>{const[i,j]=r.useState([]),[o,S]=r.useState({total_vehicles:0,moving:0,idle:0,offline:0}),[t,C]=r.useState(null),[d,W]=r.useState([]),[m,b]=r.useState(!1),[x,g]=r.useState(!1),h=r.useRef(null);r.useEffect(()=>(y(),N(),()=>{h.current&&h.current.close()}),[]);const N=()=>{try{const s=new WebSocket(`${K}/api/v1/ws/telemetry`);s.onopen=()=>{console.log("✅ WebSocket connected"),g(!0);const a=setInterval(()=>{s.readyState===WebSocket.OPEN&&s.send("ping")},3e4);s.pingInterval=a},s.onmessage=a=>{try{const l=JSON.parse(a.data);l.type==="telemetry_update"&&I(l.data,l.anomalies)}catch(l){console.error("WebSocket message parse error:",l)}},s.onerror=a=>{console.error("WebSocket error:",a),g(!1)},s.onclose=()=>{console.log("WebSocket disconnected"),g(!1),clearInterval(s.pingInterval),setTimeout(()=>{N()},5e3)},h.current=s}catch(s){console.error("Failed to connect WebSocket:",s)}},I=(s,a)=>{if(j(l=>l.map(c=>c.vehicle_id===s.vehicle_id?{...c,status:s.speed>5?"moving":"idle",location:{latitude:s.latitude,longitude:s.longitude,speed:s.speed,timestamp:s.timestamp}}:c)),a&&a.length>0){const l=i.find(c=>c.vehicle_id===s.vehicle_id);l&&a.forEach(c=>{W(A=>[{vehicle_id:s.vehicle_id,vehicle_plate:l.plate_number,anomaly:c,timestamp:new Date().toISOString()},...A.slice(0,19)])})}},y=async()=>{b(!0);try{const s=localStorage.getItem("access_token"),a=await F.get(`${k}/telemetry/vehicles/status`,{headers:{Authorization:`Bearer ${s}`}});j(a.data.vehicles),S(a.data.summary)}catch(s){console.error("Failed to load vehicles:",s)}finally{b(!1)}},R=s=>{switch(s){case"moving":return"text-green-600 bg-green-100";case"idle":return"text-yellow-600 bg-yellow-100";case"offline":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},T=s=>{switch(s){case"critical":return"bg-red-100 text-red-800 border-red-300";case"high":return"bg-orange-100 text-orange-800 border-orange-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"low":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},$=s=>{switch(s){case"speeding":return e.jsx(z,{className:"w-4 h-4"});case"harsh_braking":return e.jsx(p,{className:"w-4 h-4"});case"harsh_acceleration":return e.jsx(U,{className:"w-4 h-4"});case"temperature_violation":return e.jsx(E,{className:"w-4 h-4"});case"low_fuel":return e.jsx(V,{className:"w-4 h-4"});case"long_idle":return e.jsx(w,{className:"w-4 h-4"});default:return e.jsx(p,{className:"w-4 h-4"})}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(f,{className:"w-8 h-8 text-blue-600"}),"실시간 차량 텔레메트리"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"차량 위치, 속도, 온도 등을 실시간으로 모니터링"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${x?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx(_,{className:`w-2 h-2 ${x?"fill-green-600":"fill-red-600"}`}),e.jsx("span",{className:"text-sm font-medium",children:x?"WebSocket 연결됨":"WebSocket 연결 끊김"})]}),e.jsxs("button",{onClick:y,disabled:m,className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(v,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"새로고침"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"총 차량"}),e.jsx(n,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.total_vehicles}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"활성 차량"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"운행 중"}),e.jsx(M,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.moving}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"속도 > 5 km/h"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"정차 중"}),e.jsx(L,{className:"w-5 h-5 text-yellow-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:o.idle}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"속도 ≤ 5 km/h"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"오프라인"}),e.jsx(_,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:o.offline}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"5분 이상 미수신"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"차량 목록"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[i.length,"대 차량 실시간 모니터링"]})]}),e.jsx("div",{className:"p-6 max-h-[600px] overflow-y-auto",children:m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-8 h-8 text-gray-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"데이터 로딩 중..."})]}):i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"차량 없음"}),e.jsx("p",{className:"text-gray-500",children:"활성 차량이 없습니다"})]}):e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{onClick:()=>C(s),className:`border rounded-lg p-4 cursor-pointer transition-all ${(t==null?void 0:t.vehicle_id)===s.vehicle_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[s.plate_number,e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${R(s.status)}`,children:s.status==="moving"?"운행중":s.status==="idle"?"정차":"오프라인"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.code})]}),e.jsx(n,{className:"w-5 h-5 text-gray-400"})]}),s.location&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-gray-500",children:"속도"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[s.location.speed.toFixed(1)," km/h"]})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-gray-500",children:"위도"}),e.jsx("p",{className:"font-bold text-gray-900",children:s.location.latitude.toFixed(4)})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-gray-500",children:"경도"}),e.jsx("p",{className:"font-bold text-gray-900",children:s.location.longitude.toFixed(4)})]})]}),s.active_dispatch&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["활성 배차: ",e.jsx("span",{className:"font-medium text-gray-900",children:s.active_dispatch.order_number})]})})]},s.vehicle_id))})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-orange-500"}),"최근 이상 감지"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["실시간 알림 (",d.length,")"]})]}),e.jsx("div",{className:"p-6 max-h-[600px] overflow-y-auto",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-green-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"이상 없음"}),e.jsx("p",{className:"text-gray-500",children:"모든 차량이 정상 운행 중입니다"})]}):e.jsx("div",{className:"space-y-3",children:d.map((s,a)=>e.jsx("div",{className:`border-l-4 p-3 rounded ${T(s.anomaly.severity)}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[$(s.anomaly.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:s.vehicle_plate}),e.jsx("p",{className:"text-sm mt-1",children:s.anomaly.message}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:new Date(s.timestamp).toLocaleTimeString("ko-KR")})]})]})},a))})})]})]}),t&&t.location&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["선택된 차량: ",t.plate_number]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 mb-2",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"속도"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[t.location.speed.toFixed(1)," km/h"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-2",children:[e.jsx(n,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"위치"})]}),e.jsxs("p",{className:"text-sm font-bold text-green-900",children:[t.location.latitude.toFixed(4),", ",t.location.longitude.toFixed(4)]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-700 mb-2",children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"상태"})]}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:t.status==="moving"?"운행중":t.status==="idle"?"정차":"오프라인"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 mb-2",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"업데이트"})]}),e.jsx("p",{className:"text-sm font-bold text-orange-900",children:new Date(t.location.timestamp).toLocaleTimeString("ko-KR")})]})]}),e.jsxs("div",{className:"mt-6 bg-gray-100 rounded-lg p-8 text-center",children:[e.jsx(n,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"지도 위치 표시"}),e.jsxs("p",{className:"text-gray-600",children:["위도: ",t.location.latitude,", 경도: ",t.location.longitude]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Google Maps 또는 Mapbox API 연동으로 실제 지도에 표시 가능"})]})]})]})})};export{le as default};
