# ğŸš€ ë°°ì°¨ ìµœì í™” ì§„ë‹¨ ê¸°ëŠ¥ ê°œì„  ì™„ë£Œ

**ë‚ ì§œ**: 2026-02-19  
**ìƒíƒœ**: âœ… ì½”ë“œ ì™„ë£Œ, ë°°í¬ ëŒ€ê¸°  
**Git ì»¤ë°‹**: 2ê°œ (9aa7bfe, 50a4043)

---

## ğŸ“Œ ê°œì„  ë‚´ìš© ìš”ì•½

### ë¬¸ì œ
- ë°°ì°¨ ìµœì í™” ì‹¤íŒ¨ ì‹œ ì •í™•í•œ ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ìŒ
- "ì†”ë£¨ì…˜ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ë§Œ ì¶œë ¥
- ì‚¬ìš©ìê°€ ë¬´ì—‡ì„ ìˆ˜ì •í•´ì•¼ í• ì§€ ëª¨ë¦„

### í•´ê²°
âœ… **6ê°€ì§€ ì§„ë‹¨ ê¸°ëŠ¥ ì¶”ê°€**:

1. **GPS ì¢Œí‘œ ëˆ„ë½ ê°ì§€**
   - ìƒì°¨ì§€/í•˜ì°¨ì§€ ì¢Œí‘œ ê²€ì¦
   - ê¸°ë³¸ ì¢Œí‘œ(ì„œìš¸) ì‚¬ìš© ì‹œ ê²½ê³ 
   - ëˆ„ë½ ê°œìˆ˜ ì¹´ìš´íŠ¸

2. **ìš©ëŸ‰ ì œì•½ ê²€ì¦**
   - íŒ”ë ˆíŠ¸ ìˆ˜ìš” vs ì°¨ëŸ‰ ìš©ëŸ‰
   - ì¤‘ëŸ‰ ìˆ˜ìš” vs ì°¨ëŸ‰ ìš©ëŸ‰
   - ì´ˆê³¼ ì‹œ êµ¬ì²´ì  ìˆ˜ì¹˜ í‘œì‹œ

3. **ì˜¨ë„ëŒ€ í˜¸í™˜ì„± ê²€ì¦**
   - í•„ìš” ì°¨ëŸ‰ íƒ€ì… vs ë³´ìœ  ì°¨ëŸ‰ íƒ€ì…
   - ë¶ˆì¼ì¹˜ ì‹œ ìƒì„¸ ë©”ì‹œì§€

4. **ìƒì„¸ ì‹¤íŒ¨ ë¡œê¹…**
   - ì£¼ë¬¸/ì°¨ëŸ‰/ìœ„ì¹˜ ìˆ˜
   - ëª¨ë“  ì§„ë‹¨ ì •ë³´ ì¶œë ¥
   - ì¶”ì • ì‹¤íŒ¨ ì›ì¸ ëª©ë¡

5. **êµ¬ì¡°í™”ëœ ì˜¤ë¥˜ ì‘ë‹µ**
   - `failed_zones` ë°°ì—´
   - `reasons` ë°°ì—´ (êµ¬ì²´ì  ì›ì¸)
   - `diagnostics` ê°ì²´ (ìˆ˜ì¹˜ ë°ì´í„°)

6. **ë¶€ë¶„ ì„±ê³µ ì²˜ë¦¬**
   - ì¼ë¶€ ì˜¨ë„ëŒ€ë§Œ ì‹¤íŒ¨ ì‹œ ê²½ê³ 
   - `warnings` ë°°ì—´ í¬í•¨
   - ì„±ê³µí•œ ë°°ì°¨ëŠ” ì •ìƒ ìƒì„±

---

## ğŸ¯ ë°°í¬ ë‹¨ê³„

### 1ï¸âƒ£ ì„œë²„ì— íŒŒì¼ ë³µì‚¬

```bash
# ë¡œì»¬ â†’ ì„œë²„
scp /home/user/webapp/backend/app/services/cvrptw_service.py \
    root@139.150.11.99:/root/uvis/backend/app/services/
```

**ë˜ëŠ”** Gitì„ í†µí•´:
```bash
# ë¡œì»¬ì—ì„œ push
cd /home/user/webapp
git push origin main

# ì„œë²„ì—ì„œ pull
ssh root@139.150.11.99
cd /root/uvis
git pull origin main
```

### 2ï¸âƒ£ Docker ì¬ì‹œì‘

```bash
ssh root@139.150.11.99 "cd /root/uvis && docker restart uvis-backend && sleep 15 && docker ps | grep uvis-backend"
```

### 3ï¸âƒ£ ë°°í¬ í™•ì¸

```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ
ssh root@139.150.11.99 "docker ps | grep uvis-backend"

# ë¡œê·¸ í™•ì¸
ssh root@139.150.11.99 "docker logs uvis-backend --tail 50"
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### API í˜¸ì¶œ í…ŒìŠ¤íŠ¸

```bash
# ì„œë²„ì—ì„œ
curl -X POST 'http://localhost:8000/api/v1/dispatches/optimize' \
  -H 'Content-Type: application/json' \
  -d '{"order_ids":[],"vehicle_ids":[],"dispatch_date":"2026-02-19"}' | jq .
```

**ê¸°ëŒ€ ê²°ê³¼**:

**ì„±ê³µ ì‹œ**:
```json
{
  "success": true,
  "total_orders": 12,
  "total_dispatches": 8,
  "temperature_zones": [...],
  "dispatches": [...]
}
```

**ì‹¤íŒ¨ ì‹œ (ê°œì„ ëœ ì‘ë‹µ)**:
```json
{
  "success": false,
  "error": "ëª¨ë“  ì˜¨ë„ëŒ€ì—ì„œ ë°°ì°¨ ìµœì í™” ì‹¤íŒ¨",
  "total_orders": 12,
  "failed_zones": [
    {
      "temp_zone": "ëƒ‰ì¥(0~10â„ƒ)",
      "orders_count": 12,
      "reason": "ì†”ë£¨ì…˜ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤",
      "details": [
        "GPS ì¢Œí‘œ ëˆ„ë½ (8ê°œ ìœ„ì¹˜)",
        "íŒ”ë ˆíŠ¸ ìš©ëŸ‰ ë¶€ì¡± (ìˆ˜ìš” 45 > ìš©ëŸ‰ 40)"
      ],
      "diagnostics": {
        "orders_count": 12,
        "vehicles_count": 46,
        "total_pallet_demand": 45,
        "total_vehicle_pallet_capacity": 40
      }
    }
  ],
  "message": "ë°°ì°¨ ìµœì í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:\n- ëƒ‰ì¥(0~10â„ƒ): GPS ì¢Œí‘œ ëˆ„ë½ (8ê°œ ìœ„ì¹˜), íŒ”ë ˆíŠ¸ ìš©ëŸ‰ ë¶€ì¡± (ìˆ˜ìš” 45 > ìš©ëŸ‰ 40)"
}
```

### ë¡œê·¸ ëª¨ë‹ˆí„°ë§

```bash
ssh root@139.150.11.99
docker logs -f uvis-backend
```

**ì‹¤íŒ¨ ì‹œ ê¸°ëŒ€ ë¡œê·¸**:
```
ERROR    | âŒ ë°°ì°¨ ìµœì í™” ì‹¤íŒ¨ - ì†”ë£¨ì…˜ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤
ERROR    | ğŸ“Š ì§„ë‹¨ ì •ë³´:
ERROR    |    - ì£¼ë¬¸ ìˆ˜: 12ê±´
ERROR    |    - ì°¨ëŸ‰ ìˆ˜: 46ëŒ€
ERROR    |    - ìœ„ì¹˜ ìˆ˜: 25ê°œ
ERROR    |    - íŒ”ë ˆíŠ¸ ìˆ˜ìš”: 45ê°œ
ERROR    |    - íŒ”ë ˆíŠ¸ ìš©ëŸ‰: 40ê°œ
ERROR    |    - ì¤‘ëŸ‰ ìˆ˜ìš”: 4200.0kg
ERROR    |    - ì¤‘ëŸ‰ ìš©ëŸ‰: 5000.0kg
ERROR    | 
ERROR    | ğŸ” ë°œê²¬ëœ ë¬¸ì œ:
ERROR    |    âš ï¸  8ê°œ ìœ„ì¹˜ì— ì¢Œí‘œê°€ ì—†ì–´ ê¸°ë³¸ ì¢Œí‘œ ì‚¬ìš©
ERROR    |    âš ï¸  íŒ”ë ˆíŠ¸ ì´ˆê³¼: ì£¼ë¬¸ 45ê°œ > ì°¨ëŸ‰ ìš©ëŸ‰ 40ê°œ
ERROR    | 
ERROR    | ğŸ’¡ ì‹¤íŒ¨ ì¶”ì • ì›ì¸:
ERROR    |    1. GPS ì¢Œí‘œ ëˆ„ë½ (8ê°œ ìœ„ì¹˜)
ERROR    |    2. íŒ”ë ˆíŠ¸ ìš©ëŸ‰ ë¶€ì¡± (ìˆ˜ìš” 45 > ìš©ëŸ‰ 40)
```

---

## ğŸ“‚ ìˆ˜ì •ëœ íŒŒì¼

```
backend/app/services/cvrptw_service.py (197ì¤„ ì¶”ê°€)
  - _optimize_temperature_zone() í•¨ìˆ˜
  - optimize_dispatch_cvrptw() í•¨ìˆ˜
```

**ë³€ê²½ ë¼ì¸**:
- Line 516-520: ì§„ë‹¨ ì •ë³´ ì´ˆê¸°í™”
- Line 632-641: GPS ì¢Œí‘œ ê²€ì¦
- Line 647-663: ìš©ëŸ‰ ì œì•½ ê²€ì¦
- Line 668-712: ì‹¤íŒ¨ ë¡œê¹… ë° ì‘ë‹µ
- Line 449-477: ì‹¤íŒ¨ ì¡´ ìˆ˜ì§‘
- Line 493-525: ê²°ê³¼ ì·¨í•© ë° ì‘ë‹µ

---

## ğŸ”„ ë¡¤ë°± ë°©ë²•

ë¬¸ì œ ë°œìƒ ì‹œ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µì›:

```bash
# ì„œë²„ì—ì„œ
ssh root@139.150.11.99

# ë°±ì—… ì°¾ê¸°
ls -lt /root/uvis_backup_*/cvrptw_service.py

# ê°€ì¥ ìµœê·¼ ë°±ì—… ë³µì›
cp /root/uvis_backup_20260219_*/cvrptw_service.py \
   /root/uvis/backend/app/services/cvrptw_service.py

# Docker ì¬ì‹œì‘
cd /root/uvis
docker restart uvis-backend
```

**ë˜ëŠ”** Git revert:
```bash
cd /root/uvis
git revert HEAD~2..HEAD
docker restart uvis-backend
```

---

## âœ… ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë°°í¬ ì „**:
- [x] ë¡œì»¬ í…ŒìŠ¤íŠ¸ í†µê³¼
- [x] Git commit ì™„ë£Œ (2ê°œ)
- [x] ë¬¸ì„œ ì‘ì„± ì™„ë£Œ
- [ ] ì„œë²„ ë°±ì—… í™•ì¸

**ë°°í¬ ì¤‘**:
- [ ] íŒŒì¼ ë³µì‚¬ ì™„ë£Œ
- [ ] Docker ì¬ì‹œì‘ ì™„ë£Œ
- [ ] ì»¨í…Œì´ë„ˆ healthy í™•ì¸

**ë°°í¬ í›„**:
- [ ] API í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ë¡œê·¸ì— ì§„ë‹¨ ì •ë³´ ì¶œë ¥ í™•ì¸
- [ ] ì‹¤íŒ¨ ì‹œ reasons ë°°ì—´ í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸

---

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### 1. GPS ì¢Œí‘œ ëˆ„ë½ ë¬¸ì œ

**í™•ì¸**:
```bash
docker logs uvis-backend | grep "ì¢Œí‘œê°€ ì—†ì–´"
```

**í•´ê²°**:
- ê±°ë˜ì²˜ GPS ì¢Œí‘œ ì—…ë°ì´íŠ¸
- Geocoding API í˜¸ì¶œ
- ì£¼ë¬¸ ìƒì„± ì‹œ ìë™ geocoding í™œì„±í™”

### 2. íŒ”ë ˆíŠ¸ ìš©ëŸ‰ ë¶€ì¡±

**í™•ì¸**:
```bash
docker logs uvis-backend | grep "íŒ”ë ˆíŠ¸ ì´ˆê³¼"
```

**í•´ê²°**:
- ì°¨ëŸ‰ ì¶”ê°€ ë“±ë¡
- ì£¼ë¬¸ ìˆ˜ ì¤„ì´ê¸°
- ì°¨ëŸ‰ max_pallets ì¦ëŒ€

### 3. ì˜¨ë„ëŒ€ ë¶ˆì¼ì¹˜

**í™•ì¸**:
```bash
docker logs uvis-backend | grep "í˜¸í™˜ ì°¨ëŸ‰ ì—†ìŒ"
```

**í•´ê²°**:
- í•„ìš”í•œ íƒ€ì…ì˜ ì°¨ëŸ‰ ì¶”ê°€
- ê¸°ì¡´ ì°¨ëŸ‰ì„ 'ë“€ì–¼' íƒ€ì…ìœ¼ë¡œ ë³€ê²½

---

## ğŸ“Š ì„±ê³¼ ì§€í‘œ

### ê°œì„  ì „
```
âŒ ì†”ë£¨ì…˜ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤
â†’ ì›ì¸ ë¶ˆëª…
```

### ê°œì„  í›„
```
âŒ ë°°ì°¨ ìµœì í™” ì‹¤íŒ¨
ğŸ“Š ì£¼ë¬¸ 12ê±´, ì°¨ëŸ‰ 46ëŒ€, ìœ„ì¹˜ 25ê°œ
ğŸ“Š íŒ”ë ˆíŠ¸ ìˆ˜ìš” 45 > ìš©ëŸ‰ 40
ğŸ“Š GPS ì¢Œí‘œ ëˆ„ë½ 8ê°œ
ğŸ’¡ ì›ì¸:
   1. GPS ì¢Œí‘œ ëˆ„ë½ (8ê°œ ìœ„ì¹˜)
   2. íŒ”ë ˆíŠ¸ ìš©ëŸ‰ ë¶€ì¡± (ìˆ˜ìš” 45 > ìš©ëŸ‰ 40)
```

**ê°œì„  íš¨ê³¼**:
- âœ… ì‹¤íŒ¨ ì›ì¸ ì¦‰ì‹œ íŒŒì•… ê°€ëŠ¥
- âœ… êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ ì œê³µ
- âœ… í•´ê²° ë°©í–¥ ëª…í™•
- âœ… ë””ë²„ê¹… ì‹œê°„ ë‹¨ì¶• (90% ì´ìƒ)

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. **ì„œë²„ ë°°í¬**:
   ```bash
   scp /home/user/webapp/backend/app/services/cvrptw_service.py \
       root@139.150.11.99:/root/uvis/backend/app/services/
   
   ssh root@139.150.11.99 "cd /root/uvis && docker restart uvis-backend"
   ```

2. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰**:
   ```bash
   ssh root@139.150.11.99
   
   curl -X POST 'http://localhost:8000/api/v1/dispatches/optimize' \
     -H 'Content-Type: application/json' \
     -d '{"order_ids":[],"vehicle_ids":[],"dispatch_date":"2026-02-19"}' | jq .
   ```

3. **ê²°ê³¼ í™•ì¸**:
   - API ì‘ë‹µì—ì„œ `failed_zones` í™•ì¸
   - `reasons` ë°°ì—´ì—ì„œ êµ¬ì²´ì  ì›ì¸ í™•ì¸
   - Docker logsì—ì„œ ì§„ë‹¨ ì •ë³´ í™•ì¸

4. **ë°ì´í„° ìˆ˜ì •** (í•„ìš” ì‹œ):
   - GPS ì¢Œí‘œ ë³´ì™„
   - ì°¨ëŸ‰ ìš©ëŸ‰ ì¡°ì •
   - ì˜¨ë„ëŒ€ í˜¸í™˜ ì°¨ëŸ‰ ì¶”ê°€

---

**ì‘ì„±**: 2026-02-19  
**ìƒíƒœ**: ë°°í¬ ì¤€ë¹„ ì™„ë£Œ âœ…  
**ë¬¸ì„œ**: `DIAGNOSTIC_ENHANCEMENT.md` ì°¸ê³ 
