# 🔧 UVIS 대시보드 작동 안함 - 해결 방법

## ⚡ 빠른 해결 (3가지 방법)

프로덕션 서버 (139.150.11.99)에 SSH로 접속한 후:

---

### 방법 1: 진단 먼저 (10초) ⭐ 추천!
```bash
cd /root/uvis
git pull origin genspark_ai_developer  # 최신 스크립트 다운로드
./diagnose_system.sh
```

**무엇을 하나요?**
- 시스템 상태를 빠르게 확인
- 어디에 문제가 있는지 정확히 알려줌
- 해결 방법까지 제시

**예상 결과**:
```
1. Docker 컨테이너 상태
✓ 백엔드 헬스: 200 OK
✗ 프론트엔드 헬스: 502 실패  ← 여기가 문제!

진단 요약:
❌ 프론트엔드가 작동하지 않습니다
   해결방법: cd frontend && npm run build && cd .. && docker-compose restart frontend
```

---

### 방법 2: 빠른 수정 메뉴 (대화형) 🎯
```bash
cd /root/uvis
git pull origin genspark_ai_developer
./quick_fix.sh
```

**메뉴가 나타나면**:
```
1) 백엔드 재시작           ← 백엔드 문제면 이것
2) 프론트엔드 재빌드       ← 프론트엔드 문제면 이것
3) 데이터베이스 재시작
4) 모든 컨테이너 재시작    ← 전부 재시작하려면
5) Git 저장소 최신 코드로 업데이트
6) 환경 설정 파일 수정
7) 전체 시스템 완전 재설치 ← 가장 강력한 해결책
8) 시스템 진단만 실행

선택 (0-8): 
```

**일반적으로**:
- 대시보드가 안 열리면: **1번** 선택 (백엔드 재시작)
- 페이지가 비어있으면: **2번** 선택 (프론트엔드 재빌드)
- 다 안되면: **7번** 선택 (전체 재설치)

---

### 방법 3: 전체 자동 수정 (5-10분) 🚀 가장 강력!
```bash
cd /root/uvis
git pull origin genspark_ai_developer
./fix_all_errors.sh
```

**무엇을 하나요?**
1. ✅ 현재 파일 자동 백업
2. ✅ Git에서 최신 코드 다운로드
3. ✅ 환경 설정 파일 자동 수정
4. ✅ 데이터베이스 마이그레이션
5. ✅ 프론트엔드 완전 재빌드
6. ✅ Docker 컨테이너 전체 재시작
7. ✅ 헬스 체크 및 테스트
8. ✅ 문제가 있으면 알려줌

**언제 사용?**
- 다른 방법으로 해결 안 될 때
- 모든 것을 처음부터 깨끗하게 하고 싶을 때
- 최신 코드로 완전히 업데이트하고 싶을 때

**주의**: 로컬 변경사항은 자동으로 백업됩니다.

---

## 📋 실제 사용 예시

### 예시 1: 대시보드가 로딩 안됨

```bash
# SSH 접속
ssh root@139.150.11.99

# 1단계: 진단
cd /root/uvis
./diagnose_system.sh

# 결과: "백엔드 헬스: 502 실패" 

# 2단계: 빠른 수정
./quick_fix.sh
# → 1번 선택 (백엔드 재시작)

# 3분 후...
# 브라우저에서 Ctrl + Shift + R (강력 새로고침)
# http://139.150.11.99/ 접속
```

### 예시 2: API 호출이 404 오류

```bash
cd /root/uvis
./diagnose_system.sh

# 결과: "VITE_API_URL=http://139.150.11.99:8000/api/v1" (잘못됨)

./quick_fix.sh
# → 6번 선택 (환경 설정 수정)

# 자동으로 VITE_API_URL=/api/v1 로 수정됨
# → 2번 선택 (프론트엔드 재빌드)
```

### 예시 3: 모든 것이 작동 안함

```bash
cd /root/uvis

# 가장 강력한 방법
./fix_all_errors.sh

# 5-10분 기다림...
# 모든 것이 자동으로 수정됨!
```

---

## 🎯 문제별 빠른 해결

| 문제 증상 | 해결 방법 |
|---------|---------|
| 대시보드가 로딩 안됨 | `./quick_fix.sh` → 1번 |
| 페이지가 비어있음 | `./quick_fix.sh` → 2번 |
| 404 오류 발생 | `./quick_fix.sh` → 6번 + 2번 |
| 데이터베이스 오류 | `./quick_fix.sh` → 3번 |
| 모든 것이 안됨 | `./fix_all_errors.sh` |

---

## ✅ 수정 후 확인

### 1. 서버에서 확인
```bash
# 백엔드 체크
curl -I http://localhost:8000/health
# 응답: HTTP/1.1 200 OK ← 이래야 정상

# 프론트엔드 체크
curl -I http://localhost/
# 응답: HTTP/1.1 200 OK ← 이래야 정상
```

### 2. 브라우저에서 확인
1. **브라우저 캐시 삭제**: Ctrl + Shift + R
2. **메인 페이지 접속**: http://139.150.11.99/
3. **로그인**: admin / admin123
4. **대시보드 확인**
5. **F12 → Console 탭**: 빨간색 오류 없어야 함

### 3. Phase 8 페이지 확인
- http://139.150.11.99/billing/financial-dashboard
- http://139.150.11.99/billing/charge-preview
- http://139.150.11.99/billing/auto-schedule
- 등등...

---

## 🆘 여전히 안되면?

### 1. 로그 확인
```bash
# 백엔드 로그
docker logs uvis-backend --tail 50

# 에러만 보기
docker logs uvis-backend --tail 100 | grep -i error
```

### 2. 컨테이너 상태 확인
```bash
docker-compose ps

# 모두 "Up" 또는 "Healthy" 여야 함
```

### 3. 수동 재시작
```bash
cd /root/uvis
docker-compose down
docker-compose up -d

# 10초 대기
sleep 10

# 다시 확인
curl -I http://localhost:8000/health
```

---

## 💡 유용한 팁

### 팁 1: 브라우저 캐시가 문제일 수 있음
```
Ctrl + Shift + R    (강력 새로고침)
또는
F12 → 네트워크 탭 → "캐시 사용 안함" 체크
```

### 팁 2: 백업 위치
```bash
ls -la /root/uvis_backup_*
# fix_all_errors.sh 실행 시 자동 백업됨
```

### 팁 3: 실시간 로그 보기
```bash
docker logs uvis-backend -f
# Ctrl + C로 종료
```

---

## 📞 도움 요청 시 필요한 정보

문제가 계속되면 다음 정보를 공유하세요:

```bash
# 1. 진단 결과
./diagnose_system.sh > diagnosis.txt

# 2. 백엔드 로그
docker logs uvis-backend --tail 100 > backend.log

# 3. 프론트엔드 로그
docker logs uvis-frontend --tail 100 > frontend.log

# 4. 컨테이너 상태
docker-compose ps > containers.txt
```

그리고 브라우저 F12 → Console 탭의 오류 메시지도 스크린샷으로 캡처하세요.

---

## 🚀 요약

### 가장 빠른 해결 순서:

1. **진단** (10초)
   ```bash
   ./diagnose_system.sh
   ```

2. **빠른 수정** (3초 ~ 5분)
   ```bash
   ./quick_fix.sh
   ```

3. **전체 수정** (5-10분) - 최종 수단
   ```bash
   ./fix_all_errors.sh
   ```

### 99%의 문제는 이것으로 해결됩니다!

---

## 📝 체크리스트

수정 후 확인:

- [ ] `./diagnose_system.sh` 실행 - 모두 ✓ 표시
- [ ] 백엔드 헬스 체크: 200 OK
- [ ] 프론트엔드 헬스 체크: 200 OK
- [ ] http://139.150.11.99/ 접속 가능
- [ ] 로그인 가능: admin / admin123
- [ ] 대시보드 페이지 표시
- [ ] F12 Console에 오류 없음

**모두 체크되면 완료!** ✅

---

**필요한 파일**:
- `diagnose_system.sh` - 진단 스크립트
- `quick_fix.sh` - 빠른 수정 메뉴
- `fix_all_errors.sh` - 전체 오류 수정

**최신 버전 다운로드**:
```bash
cd /root/uvis
git pull origin genspark_ai_developer
```

**작성일**: 2026-02-06  
**상태**: 사용 준비 완료 ✅
